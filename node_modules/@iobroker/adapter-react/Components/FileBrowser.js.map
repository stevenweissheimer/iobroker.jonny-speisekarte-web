{"version":3,"sources":["FileBrowser.js"],"names":["ROW_HEIGHT","BUTTON_WIDTH","TILE_HEIGHT","TILE_WIDTH","NOT_FOUND","styles","theme","dialog","height","mixins","toolbar","minHeight","root","width","overflow","position","filesDiv","spacing","overflowX","overflowY","padding","filesDivTable","filesDivTile","display","alignContent","alignItems","flexWrap","flex","itemTile","userSelect","cursor","textAlign","opacity","transition","margin","background","palette","secondary","light","color","Utils","invertColor","main","itemNameFolderTile","fontWeight","itemNameTile","textOverflow","fontSize","wordBreak","itemFolderIconTile","paddingLeft","itemFolderIconBack","top","left","zIndex","type","itemSizeTile","itemImageTile","objectFit","itemIconTile","itemSelected","primary","itemTable","lineHeight","itemNameTable","verticalAlign","flexGrow","itemNameFolderTable","itemSizeTable","itemAccessTable","paddingRight","justifyContent","itemImageTable","marginTop","maxHeight","itemIconTable","itemFolderTable","itemFolderTemp","itemFolderIconTable","marginLeft","itemDownloadButtonTable","minWidth","paddingTop","itemAclButtonTable","itemDeleteButtonTable","uploadDiv","bottom","right","uploadDivDragging","uploadCenterDiv","border","borderRadius","uploadCenterIcon","uploadCenterText","uploadCloseButton","uploadCenterTextAndIcon","menuButtonExpertActive","pathDiv","marginRight","whiteSpace","pathDivInput","pathDivBreadcrumb","paddingBottom","borderBottom","pathDivBreadcrumbDir","pathDivBreadcrumbSlash","pathDivBreadcrumbFile","backgroundImageLight","backgroundImageDark","backgroundImageColored","direction","USER_DATA","sortFolders","a","b","folder","name","getParentDir","dir","parts","split","length","pop","join","isFile","path","ext","getFileExtension","toLowerCase","match","TABLE","TILE","FileBrowser","props","array","setState","backgroundImage","indexOf","window","localStorage","setItem","state","classes","expanded","getItem","JSON","parse","e","viewType","showViewTypeButton","selected","currentDir","folders","filterEmpty","expertMode","addFolder","uploadFile","deleteItem","marked","viewer","formatEditFile","errorText","modalEditOfAccess","queueLength","imagePrefix","levelPadding","mounted","suppressDeleteConfirm","browseList","browseListRunning","loadFolders","browseFolder","then","browseFolders","Promise","resolve","findItem","pathFocus","scrollToSelected","el","document","getElementById","scrollIntoView","foldersList","_newFolders","_resolve","Object","keys","forEach","shift","setTimeout","adapter","relPath","reject","push","processBrowseList","level","processing","socket","readDir","files","item","folderId","_checkEmpty","all","filter","map","id","error","readMetaItems","objs","_folders","userData","obj","_id","title","common","meta","from","ts","icon","acl","sort","unshift","alert","readDirSerial","file","isDir","size","stats","modified","modifiedAt","stopPropagation","pos","stringify","temp","err","t","splice","lastSelect","Date","now","onSelect","filterFiles","includes","filterByType","EXTENSIONS","Icon","IconOpen","IconClosed","select","changeFolder","toggleFolder","lang","clsx","undefined","formatAcl","allowDownload","allowDelete","startsWith","formatBytes","access","permissions","toString","padStart","images","target","onerror","src","NoImage","getClassBackgroundImage","getFileIcon","formatSize","getEditFile","res","renderBackFolder","renderFolder","renderFile","renderItems","showExpertButton","menuButton","allowCreateFolder","allowUpload","setStateBackgroundImage","parentFolder","find","findFirstFolder","text","parent","replace","prevProps","prevState","snapshot","setOpacityTimer","clearTimeout","items","getElementsByClassName","i","style","fileName","data","writeFile64","acceptedFiles","count","reader","FileReader","onabort","console","log","onload","result","readAsArrayBuffer","getRootProps","getInputProps","deleteRecursive","deleteFile","themeName","info","changed","it","p","part","keyCode","changeToPath","value","renderBreadcrumb","ready","key","className","showToolbar","renderToolbar","renderPath","renderInputDialog","renderUpload","renderDeleteDialog","allowView","renderViewDialog","modalEditOfAccessControl","modalEditOfAccessObjData","renderError","Component","defaultProps","objectAddBoolean","objectEditBoolean","objectStatesView","objectImportExport","objectEditOfAccessControl","modalNewObject","propTypes","PropTypes","string","object","func","bool","tileView","_export"],"mappings":"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","sourcesContent":["/**\r\n * Copyright 2020-2021, bluefox <dogafox@gmail.com>\r\n *\r\n * MIT License\r\n *\r\n **/\r\nimport withWidth from '@material-ui/core/withWidth';\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport React, { Component } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport Dropzone from 'react-dropzone'\r\n\r\nimport LinearProgress from '@material-ui/core/LinearProgress';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport Fab from '@material-ui/core/Fab';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogContentText from '@material-ui/core/DialogContentText';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport Button from '@material-ui/core/Button';\r\nimport Input from '@material-ui/core/Input';\r\nimport { Hidden, Tooltip } from '@material-ui/core';\r\n\r\nimport ErrorDialog from '../Dialogs/Error';\r\nimport Utils from './Utils';\r\nimport TextInputDialog from '../Dialogs/TextInput';\r\nimport { EXTENSIONS } from './FileViewer';\r\nimport FileViewer from './FileViewer';\r\n//import FileViewer from '@iobroker/adapter-react/Components/FileViewer';\r\n\r\n// Icons\r\nimport RefreshIcon from '@material-ui/icons/Refresh';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport JsonIcon from '@material-ui/icons/Bookmark';\r\nimport CssIcon from '@material-ui/icons/BookmarkBorder';\r\nimport HtmlIcon from '@material-ui/icons/Description';\r\nimport EditIcon from '@material-ui/icons/Edit';\r\nimport JSIcon from '@material-ui/icons/Code';\r\nimport FileIcon from '@material-ui/icons/InsertDriveFile';\r\nimport UploadIcon from '@material-ui/icons/Publish';\r\nimport MusicIcon from '@material-ui/icons/MusicNote';\r\nimport DownloadIcon from '@material-ui/icons/SaveAlt';\r\nimport AddFolderIcon from '@material-ui/icons/CreateNewFolder';\r\nimport EmptyFilterIcon from '@material-ui/icons/FolderOpen';\r\nimport IconList from '@material-ui/icons/List';\r\nimport IconTile from '@material-ui/icons/ViewModule';\r\nimport IconBack from '@material-ui/icons/ArrowBack';\r\nimport DeleteIcon from '@material-ui/icons/Delete';\r\nimport Brightness5Icon from '@material-ui/icons/Brightness6';\r\n\r\nimport ExpertIcon from  '../icons/IconExpert';\r\nimport NoImage from '../assets/no_icon.svg';\r\nimport IconClosed from '../icons/IconClosed';\r\nimport IconOpen from '../icons/IconOpen';\r\n\r\nconst ROW_HEIGHT   = 32;\r\nconst BUTTON_WIDTH = 32;\r\nconst TILE_HEIGHT  = 120;\r\nconst TILE_WIDTH   = 64;\r\n\r\nconst NOT_FOUND = 'Not found';\r\n\r\nconst styles = theme => ({\r\n    dialog: {\r\n        height: `calc(100% - ${theme.mixins.toolbar.minHeight}px)`,\r\n    },\r\n    root: {\r\n        width: '100%',\r\n        overflow: 'hidden',\r\n        height: '100%',\r\n        position: 'relative',\r\n    },\r\n    filesDiv: {\r\n        width: `calc(100% - ${theme.spacing(2)}px)`,\r\n        overflowX: 'hidden',\r\n        overflowY: 'auto',\r\n        padding: theme.spacing(1),\r\n    },\r\n    filesDivTable: {\r\n        height: `calc(100% - ${48 + theme.spacing(1)}px)`,\r\n    },\r\n    filesDivTile: {\r\n        height: `calc(100% - ${48 * 2 + theme.spacing(1)}px)`,\r\n        display: 'flex',\r\n        alignContent: 'flex-start',\r\n        alignItems: 'stretch',\r\n        flexWrap: 'wrap',\r\n        flex: `0 0 ${TILE_WIDTH}px`,\r\n    },\r\n\r\n    itemTile: {\r\n        position: 'relative',\r\n        userSelect: 'none',\r\n        cursor: 'pointer',\r\n        height: TILE_HEIGHT,\r\n        width: TILE_WIDTH,\r\n        display: 'inline-block',\r\n        textAlign: 'center',\r\n        opacity: 0.1,\r\n        transition: 'opacity 1s',\r\n        margin: 4,\r\n        '&:hover': {\r\n            background: theme.palette.secondary.light,\r\n            color: Utils.invertColor(theme.palette.secondary.main, true),\r\n        }\r\n    },\r\n    itemNameFolderTile: {\r\n        fontWeight: 'bold',\r\n    },\r\n    itemNameTile: {\r\n        width: '100%',\r\n        height: 32,\r\n        overflow: 'hidden',\r\n        textOverflow: 'ellipsis',\r\n        fontSize: 12,\r\n        textAlign: 'center',\r\n        wordBreak: 'break-all',\r\n    },\r\n    itemFolderIconTile: {\r\n        width: '100%',\r\n        height: TILE_HEIGHT - 32 - 16 - 8, // name + size\r\n        display: 'block',\r\n        paddingLeft: 8,\r\n        color: theme.palette.secondary.main || '#fbff7d',\r\n    },\r\n    itemFolderIconBack: {\r\n        position: 'absolute',\r\n        top: 22,\r\n        left: 18,\r\n        zIndex: 1,\r\n        color: theme.palette.type === 'dark' ? '#FFF' : '#000',\r\n    },\r\n    itemSizeTile: {\r\n        width: '100%',\r\n        height: 16,\r\n        textAlign: 'center',\r\n        fontSize: 10,\r\n    },\r\n    itemImageTile: {\r\n        width: 'calc(100% - 8px)',\r\n        height: TILE_HEIGHT - 32 - 16 - 8, // name + size\r\n        margin: 4,\r\n        display: 'block',\r\n        textAlign: 'center',\r\n        objectFit: 'contain',\r\n    },\r\n    itemIconTile: {\r\n        width: '100%',\r\n        height: TILE_HEIGHT - 32 - 16 - 8, // name + size\r\n        display: 'block',\r\n        objectFit: 'contain',\r\n    },\r\n\r\n    itemSelected: {\r\n        background: theme.palette.primary.main,\r\n        color: Utils.invertColor(theme.palette.primary.main, true),\r\n    },\r\n\r\n    itemTable: {\r\n        userSelect: 'none',\r\n        cursor: 'pointer',\r\n        height: ROW_HEIGHT,\r\n        display: 'inline-flex',\r\n        lineHeight: ROW_HEIGHT + 'px',\r\n        '&:hover': {\r\n            background: theme.palette.secondary.light,\r\n            color: Utils.invertColor(theme.palette.secondary.main, true),\r\n        }\r\n    },\r\n    itemNameTable: {\r\n        display: 'inline-block',\r\n        paddingLeft: 10,\r\n        fontSize: '1rem',\r\n        verticalAlign: 'top',\r\n        flexGrow: 1,\r\n    },\r\n    itemNameFolderTable: {\r\n        fontWeight: 'bold',\r\n    },\r\n    itemSizeTable: {\r\n        display: 'inline-block',\r\n        width: 60,\r\n        verticalAlign: 'top',\r\n        textAlign: 'right'\r\n    },\r\n    itemAccessTable: {\r\n        // display: 'inline-block',\r\n        verticalAlign: 'top',\r\n        width: 60,\r\n        textAlign: 'right',\r\n        paddingRight: 5,\r\n        display: 'flex',\r\n        justifyContent: 'center'\r\n    },\r\n    itemImageTable: {\r\n        display: 'inline-block',\r\n        width: 30,\r\n        marginTop: 1,\r\n        objectFit: 'contain',\r\n        maxHeight: 30,\r\n    },\r\n    itemIconTable: {\r\n        display: 'inline-block',\r\n        marginTop: 1,\r\n        width: 30,\r\n        height: 30,\r\n    },\r\n    itemFolderTable: {\r\n\r\n    },\r\n    itemFolderTemp: {\r\n        opacity: 0.4\r\n    },\r\n    itemFolderIconTable: {\r\n        marginTop: 1,\r\n        marginLeft: theme.spacing(1),\r\n        display: 'inline-block',\r\n        width: 30,\r\n        height: 30,\r\n        color: theme.palette.secondary.main || '#fbff7d',\r\n    },\r\n    itemDownloadButtonTable: {\r\n        display: 'inline-block',\r\n        width: BUTTON_WIDTH,\r\n        height: ROW_HEIGHT,\r\n        minWidth: BUTTON_WIDTH,\r\n        verticalAlign: 'top',\r\n        padding: 0,\r\n        '& span': {\r\n            paddingTop: 9\r\n        },\r\n        '& svg': {\r\n            width: 14,\r\n            height: 14,\r\n            fontSize: '1rem'\r\n        }\r\n    },\r\n    itemAclButtonTable: {\r\n        width: BUTTON_WIDTH,\r\n        height: ROW_HEIGHT,\r\n        minWidth:BUTTON_WIDTH,\r\n        verticalAlign: 'top',\r\n        padding: 0,\r\n        fontSize: 12,\r\n        display: 'flex'\r\n    },\r\n    itemDeleteButtonTable: {\r\n        display: 'inline-block',\r\n        width: BUTTON_WIDTH,\r\n        height: ROW_HEIGHT,\r\n        minWidth: BUTTON_WIDTH,\r\n        verticalAlign: 'top',\r\n        padding: 0,\r\n        '& svg': {\r\n            width: 18,\r\n            height: 18,\r\n            fontSize: '1.5rem'\r\n        }\r\n    },\r\n\r\n    uploadDiv: {\r\n        top: 0,\r\n        zIndex: 1,\r\n        bottom: 0,\r\n        left: 0,\r\n        right: 0,\r\n        position: 'absolute',\r\n        opacity: 0.9,\r\n        textAlign: 'center',\r\n        background: '#FFFFFF',\r\n    },\r\n    uploadDivDragging: {\r\n        opacity: 1,\r\n    },\r\n\r\n    uploadCenterDiv: {\r\n        margin: 20,\r\n        border: '3px dashed grey',\r\n        borderRadius: 30,\r\n        width: 'calc(100% - 40px)',\r\n        height: 'calc(100% - 40px)',\r\n        position: 'relative',\r\n        color: theme.palette.type === 'dark' ? '#222' : '#CCC'\r\n    },\r\n    uploadCenterIcon: {\r\n        width: '25%',\r\n        height: '25%',\r\n    },\r\n    uploadCenterText: {\r\n        fontSize: 24,\r\n        fontWeight: 'bold',\r\n    },\r\n    uploadCloseButton: {\r\n        zIndex: 2,\r\n        position: 'absolute',\r\n        top: 30,\r\n        right: 30,\r\n    },\r\n    uploadCenterTextAndIcon: {\r\n        position: 'absolute',\r\n        top: '50%',\r\n        left: '50%',\r\n        height: '30%',\r\n        width: '50%',\r\n        margin: '-15% 0 0 -25%',\r\n    },\r\n    menuButtonExpertActive: {\r\n        color: '#c00000',\r\n    },\r\n    pathDiv: {\r\n        display: 'flex',\r\n        width: `calc(100% - ${theme.spacing(2)}px)`,\r\n        marginLeft: theme.spacing(1),\r\n        marginRight: theme.spacing(1),\r\n        textOverflow: 'clip',\r\n        overflow: 'hidden',\r\n        whiteSpace: 'nowrap'\r\n    },\r\n    pathDivInput: {\r\n        width: '100%',\r\n    },\r\n    pathDivBreadcrumb: {\r\n        paddingTop: 3,\r\n        paddingBottom: 2,\r\n        borderBottom: 'solid 1px',\r\n    },\r\n    pathDivBreadcrumbDir: {\r\n        paddingLeft: 4,\r\n        paddingRight: 4,\r\n        paddingBottom: 4,\r\n        cursor: 'pointer',\r\n        '&:hover': {\r\n            background: theme.palette.type === 'dark' ? '#333' : '#CCC',\r\n        },\r\n    },\r\n    pathDivBreadcrumbSlash: {\r\n        paddingLeft: 4,\r\n        paddingRight: 4,\r\n        paddingBottom: 4,\r\n        opacity: 0.7,\r\n    },\r\n    pathDivBreadcrumbFile: {\r\n        cursor: 'pointer',\r\n        flexGrow: 1,\r\n    },\r\n    backgroundImageLight: {\r\n        background: 'white'\r\n    },\r\n    backgroundImageDark: {\r\n        background: 'black'\r\n    },\r\n    backgroundImageColored: {\r\n        background: 'silver'\r\n    },\r\n    '@media screen and (max-width: 500px)': {\r\n        itemNameTable: {\r\n            whiteSpace: 'nowrap',\r\n            overflow: 'hidden',\r\n            textOverflow: 'ellipsis',\r\n            textAlign: 'end',\r\n            direction: 'rtl'\r\n        }\r\n    },\r\n});\r\n\r\nconst USER_DATA = '0_userdata.0';\r\n\r\nfunction sortFolders(a, b) {\r\n    if (a.folder && b.folder) {\r\n        return a.name > b.name ? 1 : (a.name < b.name ? -1 : 0);\r\n    } else if (a.folder) {\r\n        return -1;\r\n    } else if (b.folder) {\r\n        return 1;\r\n    } else {\r\n        return a.name > b.name ? 1 : (a.name < b.name ? -1 : 0)\r\n    }\r\n}\r\n\r\nfunction getParentDir(dir) {\r\n    const parts = (dir || '').split('/');\r\n    parts.length && parts.pop();\r\n    return parts.join('/');\r\n}\r\n\r\nfunction isFile(path) {\r\n    let ext = Utils.getFileExtension(path);\r\n    if (ext && ext.toLowerCase().match(/[a-z]+/) && ext.length < 5) {\r\n        return true;\r\n    } else {\r\n        return false;\r\n    }\r\n}\r\n\r\nconst TABLE = 'Table';\r\nconst TILE = 'Tile';\r\n\r\n/**\r\n * @extends {React.Component<import('./types').FileBrowserProps>}\r\n */\r\nclass FileBrowser extends Component {\r\n    /**\r\n     * @param {Readonly<import(\"./types\").FileBrowserProps>} props\r\n     */\r\n    constructor(props) {\r\n        super(props);\r\n        let expanded = window.localStorage.getItem('files.expanded') || '[]';\r\n\r\n        try {\r\n            expanded = JSON.parse(expanded);\r\n        } catch (e) {\r\n            expanded = [];\r\n        }\r\n\r\n        let viewType;\r\n        if (this.props.showViewTypeButton) {\r\n            viewType = window.localStorage.getItem('files.viewType') || TABLE;\r\n        } else {\r\n            viewType = TABLE;\r\n        }\r\n\r\n        let selected = this.props.selected || window.localStorage.getItem('files.selected') || USER_DATA;\r\n        let currentDir = '';\r\n        if (isFile(selected)) {\r\n            currentDir = getParentDir(selected);\r\n        } else {\r\n            currentDir = selected;\r\n        }\r\n        let backgroundImage = window.localStorage.getItem('files.backgroundImage') || null;\r\n\r\n        this.state = {\r\n            viewType,\r\n            folders: {},\r\n            filterEmpty: window.localStorage.getItem('files.empty') !== 'false',\r\n            expanded,\r\n            currentDir,\r\n            expertMode: this.props.expertMode,\r\n            addFolder: false,\r\n            uploadFile: false,\r\n            deleteItem: '',\r\n            marked: [],\r\n            viewer: '',\r\n            formatEditFile: '',\r\n            path: selected,\r\n            selected,\r\n            errorText: '',\r\n            modalEditOfAccess: false,\r\n            backgroundImage,\r\n            queueLength: 0\r\n        };\r\n\r\n        this.imagePrefix = this.props.imagePrefix || './files/';\r\n\r\n        this.levelPadding = this.props.levelPadding || 20;\r\n        this.mounted = true;\r\n        this.suppressDeleteConfirm = 0;\r\n\r\n        this.browseList = [];\r\n        this.browseListRunning = false;\r\n\r\n        this.loadFolders();\r\n    }\r\n\r\n    static getDerivedStateFromProps(props, state) {\r\n        if (props.expertMode !== undefined && props.expertMode !== state.expertMode) {\r\n            return { expertMode: props.expertMode };\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    loadFolders() {\r\n        return this.browseFolder('/')\r\n            .then(folders => {\r\n                return this.state.viewType === TABLE ?\r\n                    this.browseFolders([...this.state.expanded], folders)\r\n                    :\r\n                    (this.state.currentDir && this.state.currentDir !== '/' ? this.browseFolder(this.state.currentDir, folders) : Promise.resolve(folders))\r\n            })\r\n            .then(folders => this.setState({ folders }, () => {\r\n                if (this.state.viewType === TABLE && !this.findItem(this.state.selected)) {\r\n                    const parts = this.state.selected.split('/');\r\n                    while (parts.length && !this.findItem(parts.join('/'))) {\r\n                        parts.pop();\r\n                    }\r\n                    let selected;\r\n                    if (parts.length) {\r\n                        selected = parts.join('/');\r\n                    } else {\r\n                        selected = USER_DATA;\r\n                    }\r\n                    this.setState({ selected, path: selected, pathFocus: false }, () => this.scrollToSelected());\r\n                } else {\r\n                    this.scrollToSelected();\r\n                }\r\n            }));\r\n    }\r\n\r\n    scrollToSelected() {\r\n        if (this.mounted) {\r\n            const el = document.getElementById(this.state.selected);\r\n            el && el.scrollIntoView();\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.mounted = true;\r\n        this.scrollToSelected();\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        this.mounted = false;\r\n    }\r\n\r\n    browseFolders(foldersList, _newFolders, _resolve) {\r\n        if (!_newFolders) {\r\n            _newFolders = {};\r\n            Object.keys(this.state.folders).forEach(folder => _newFolders[folder] = this.state.folders[folder]);\r\n        }\r\n\r\n        if (!_resolve) {\r\n            return new Promise(resolve => this.browseFolders(foldersList, _newFolders, resolve));\r\n        }\r\n\r\n        if (!foldersList || !foldersList.length) {\r\n            _resolve(_newFolders);\r\n        } else {\r\n            this.browseFolder(foldersList.shift(), _newFolders)\r\n                .then(() => setTimeout(() => this.browseFolders(foldersList, _newFolders, _resolve), 0))\r\n                .catch(() => setTimeout(() => this.browseFolders(foldersList, _newFolders, _resolve), 0))\r\n        }\r\n    }\r\n\r\n    readDirSerial(adapter, relPath) {\r\n        return new Promise((resolve, reject) => {\r\n            this.browseList.push({resolve, reject, adapter, relPath});\r\n            !this.browseListRunning && this.processBrowseList();\r\n        });\r\n    }\r\n\r\n    processBrowseList(level) {\r\n        if (!this.browseListRunning && this.browseList.length) {\r\n            this.browseListRunning = true;\r\n            if (this.browseList.length > 10) {\r\n                // not too often\r\n                if (!(this.browseList.length % 10)) {\r\n                    this.setState({queueLength: this.browseList.length});\r\n                }\r\n            } else {\r\n                this.setState({queueLength: this.browseList.length});\r\n            }\r\n\r\n            this.browseList[0].processing = true;\r\n            this.props.socket.readDir(this.browseList[0].adapter, this.browseList[0].relPath)\r\n                .then(files => {\r\n                    const item = this.browseList.shift();\r\n                    const resolve = item.resolve;\r\n                    item.resolve = null;\r\n                    item.reject  = null;\r\n                    item.adapter = null;\r\n                    item.relPath = null;\r\n                    resolve(files);\r\n                    this.browseListRunning = false;\r\n                    if (this.browseList.length) {\r\n                        if (level < 5) {\r\n                            this.processBrowseList(level + 1);\r\n                        } else {\r\n                            setTimeout(() => this.processBrowseList(0), 0);\r\n                        }\r\n                    } else {\r\n                        this.setState({queueLength: 0});\r\n                    }\r\n                })\r\n                .catch(e => {\r\n                    const item = this.browseList.shift();\r\n                    const reject = item.reject;\r\n                    item.resolve = null;\r\n                    item.reject  = null;\r\n                    item.adapter = null;\r\n                    item.relPath = null;\r\n                    reject(e);\r\n                    this.browseListRunning = false;\r\n                    if (this.browseList.length) {\r\n                        if (level < 5) {\r\n                            this.processBrowseList(level + 1);\r\n                        } else {\r\n                            setTimeout(() => this.processBrowseList(0), 0);\r\n                        }\r\n                    } else {\r\n                        this.setState({queueLength: 0});\r\n                    }\r\n                });\r\n        }\r\n    }\r\n\r\n    browseFolder(folderId, _newFolders, _checkEmpty) {\r\n        if (!_newFolders) {\r\n            _newFolders = {};\r\n            Object.keys(this.state.folders).forEach(folder => _newFolders[folder] = this.state.folders[folder]);\r\n        }\r\n\r\n        if (_newFolders[folderId]) {\r\n            if (!_checkEmpty) {\r\n                return new Promise((resolve, reject) =>\r\n                    Promise.all(_newFolders[folderId].filter(item => item.folder).map(item =>\r\n                        this.browseFolder(item.id, _newFolders, true)\r\n                            .catch(error => { })))\r\n                        .then(() => resolve(_newFolders))\r\n                        .catch(error => reject(error)));\r\n            } else {\r\n                return Promise.resolve(_newFolders);\r\n            }\r\n        }\r\n\r\n        if (!folderId || folderId === '/') {\r\n            return this.props.socket.readMetaItems()\r\n                .then(objs => {\r\n                    const _folders = [];\r\n                    let userData = null;\r\n\r\n                    // load only adapter.admin and not other meta files like hm-rpc.0.devices.blablabla\r\n                    objs = objs.filter(obj => obj._id.split('.').length <= 2);\r\n\r\n                    objs.forEach(obj => {\r\n                        const item = {\r\n                            id:     obj._id,\r\n                            name:   obj._id,\r\n                            title: (obj.common && obj.common.name) || obj._id,\r\n                            meta:   true,\r\n                            from:   obj.from,\r\n                            ts:     obj.ts,\r\n                            color:  obj.common && obj.common.color,\r\n                            icon:   obj.common && obj.common.icon,\r\n                            folder: true,\r\n                            acl:    obj.acl,\r\n                            level:  0\r\n                        };\r\n                        if (item.id === USER_DATA) {\r\n                            // user data must be first\r\n                            userData = item;\r\n                        } else {\r\n                            _folders.push(item);\r\n                        }\r\n                    });\r\n                    _folders.sort((a, b) => a.id > b.id ? 1 : (a.id < b.id ? -1 : 0));\r\n                    _folders.unshift(userData);\r\n\r\n                    _newFolders[folderId || '/'] = _folders;\r\n\r\n                    if (!_checkEmpty) {\r\n                        return Promise.all(_folders.filter(item => item.folder).map(item =>\r\n                            this.browseFolder(item.id, _newFolders, true).catch(error => { })))\r\n                            .then(() => _newFolders)\r\n                    } else {\r\n                        return _newFolders;\r\n                    }\r\n                })\r\n                .catch(e => window.alert('Cannot read meta items: ' + e));\r\n        } else {\r\n            const parts   = folderId.split('/');\r\n            const level   = parts.length;\r\n            const adapter = parts.shift();\r\n            const relPath = parts.join('/');\r\n\r\n            // make all requests here serial\r\n            return this.readDirSerial(adapter, relPath)\r\n                .then(files => {\r\n                    const _folders = [];\r\n                    files.forEach(file => {\r\n                        const item = {\r\n                            id:       folderId + '/' + file.file,\r\n                            ext:      Utils.getFileExtension(file.file),\r\n                            folder:   file.isDir,\r\n                            name:     file.file,\r\n                            size:     file.stats && file.stats.size,\r\n                            modified: file.modifiedAt,\r\n                            acl:      file.acl,\r\n                            level\r\n                        };\r\n                        _folders.push(item);\r\n                    });\r\n\r\n                    _folders.sort(sortFolders);\r\n                    _newFolders[folderId] = _folders;\r\n\r\n                    if (!_checkEmpty) {\r\n                        return Promise.all(_folders.filter(item => item.folder).map(item => this.browseFolder(item.id, _newFolders, true)))\r\n                            .then(() => _newFolders)\r\n                    } else {\r\n                        return _newFolders;\r\n                    }\r\n                })\r\n                .catch(e => {\r\n                    window.alert(`Cannot read ${adapter}${relPath ? '/' + relPath : ''}: ${e}`)\r\n                });\r\n        }\r\n    }\r\n\r\n    toggleFolder(item, e) {\r\n        e && e.stopPropagation();\r\n        const expanded = [...this.state.expanded];\r\n        const pos = expanded.indexOf(item.id);\r\n        if (pos === -1) {\r\n            expanded.push(item.id);\r\n            expanded.sort();\r\n\r\n            window.localStorage.setItem('files.expanded', JSON.stringify(expanded));\r\n\r\n            if (!item.temp) {\r\n                return this.browseFolder(item.id)\r\n                    .then(folders => this.setState({ expanded, folders }))\r\n                    .catch(err => window.alert(err === NOT_FOUND ? this.props.t('re_Cannot find \"%s\"', item.id) : this.props.t('re_Cannot read \"%s\"', item.id)));\r\n            } else {\r\n                this.setState({ expanded });\r\n            }\r\n        } else {\r\n            expanded.splice(pos, 1);\r\n            window.localStorage.setItem('files.expanded', JSON.stringify(expanded));\r\n            this.setState({ expanded });\r\n        }\r\n    }\r\n\r\n    changeFolder(e, folder) {\r\n        e && e.stopPropagation();\r\n\r\n        this.lastSelect = Date.now();\r\n\r\n        folder = folder || getParentDir(this.state.currentDir);\r\n\r\n        if (folder === '/') {\r\n            folder = '';\r\n        }\r\n\r\n        window.localStorage.setItem('files.currentDir', folder);\r\n\r\n        if (folder && !this.state.folders[folder]) {\r\n            return this.browseFolder(folder)\r\n                .then(folders =>\r\n                    this.setState({ folders, path: folder, currentDir: folder, selected: folder, pathFocus: false }, () => this.props.onSelect && this.props.onSelect('')));\r\n        } else {\r\n            this.setState({ currentDir: folder, selected: folder, path: folder, pathFocus: false }, () => this.props.onSelect && this.props.onSelect(''));\r\n        }\r\n    }\r\n\r\n    select(id, e) {\r\n        e && e.stopPropagation();\r\n        this.lastSelect = Date.now();\r\n        window.localStorage.setItem('files.selected', id);\r\n        this.setState({ selected: id, path: id, pathFocus: false }, () => {\r\n            if (this.props.onSelect) {\r\n                const ext = Utils.getFileExtension(id);\r\n                if ((!this.props.filterFiles || this.props.filterFiles.includes(ext)) &&\r\n                    (!this.props.filterByType || EXTENSIONS[this.props.filterByType].includes(ext))\r\n                ) {\r\n                    this.props.onSelect(id);\r\n                } else {\r\n                    this.props.onSelect('');\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    renderFolder(item, expanded) {\r\n        if (this.state.filterEmpty && (!this.state.folders[item.id] || !this.state.folders[item.id].length) && item.id !== USER_DATA && !item.temp) {\r\n            return null;\r\n        }\r\n        const Icon = expanded ? IconOpen : IconClosed;\r\n        const padding = this.state.viewType === TABLE ? item.level * this.levelPadding : 0;\r\n        return <div key={item.id}\r\n            id={item.id}\r\n            style={this.state.viewType === TABLE ? { marginLeft: padding, width: 'calc(100% - ' + padding + 'px' } : {}}\r\n            onClick={e => this.state.viewType === TABLE ? this.select(item.id, e) : this.changeFolder(e, item.id)}\r\n            onDoubleClick={e => this.state.viewType === TABLE && this.toggleFolder(item, e)}\r\n            title={item.title && typeof item.title === 'object' ? item.title[this.props.lang] : item.title || null}\r\n            className={Utils.clsx(\r\n                'browserItem',\r\n                this.props.classes['item' + this.state.viewType],\r\n                this.props.classes['itemFolder' + this.state.viewType],\r\n                this.state.selected === item.id && this.props.classes.itemSelected,\r\n                item.temp && this.props.classes['itemFolderTemp'],\r\n            )}>\r\n            <Icon className={this.props.classes['itemFolderIcon' + this.state.viewType]} onClick={this.state.viewType === TABLE ? e => this.toggleFolder(item, e) : undefined} />\r\n\r\n            <div className={Utils.clsx(this.props.classes['itemName' + this.state.viewType], this.props.classes['itemNameFolder' + this.state.viewType])}\r\n            >{item.name === USER_DATA ? this.props.t('ra_User files') : item.name}</div>\r\n\r\n            <Hidden xsDown>\r\n                {<div className={this.props.classes['itemSize' + this.state.viewType]}>{this.state.viewType === TABLE && this.state.folders[item.id] ? this.state.folders[item.id].length : ''}</div>}\r\n            </Hidden>\r\n\r\n            <Hidden xsDown>\r\n                {this.state.viewType === TABLE ? this.formatAcl(item.acl) : null}\r\n            </Hidden>\r\n            <Hidden xsDown>\r\n                {this.state.viewType === TABLE && this.props.expertMode && <div className={this.props.classes['itemDeleteButton' + this.state.viewType]} />}\r\n            </Hidden>\r\n            {this.state.viewType === TABLE && this.props.allowDownload ? <div className={this.props.classes['itemDownloadButton' + this.state.viewType]} /> : null}\r\n\r\n            {this.state.viewType === TABLE && this.props.allowDelete && this.state.folders[item.id] && this.state.folders[item.id].length && (this.state.expertMode || item.id.startsWith(USER_DATA) || item.id.startsWith('vis.0/')) ?\r\n                <IconButton aria-label=\"delete\"\r\n                    onClick={e => {\r\n                        e.stopPropagation();\r\n                        if (this.suppressDeleteConfirm > Date.now()) {\r\n                            this.deleteItem(item.id);\r\n                        } else {\r\n                            this.setState({ deleteItem: item.id });\r\n                        }\r\n                    }}\r\n                    className={this.props.classes['itemDeleteButton' + this.state.viewType]}\r\n                >\r\n                    <DeleteIcon fontSize=\"small\" />\r\n                </IconButton>\r\n                :\r\n                (this.state.viewType === TABLE && this.props.allowDelete ? <div className={this.props.classes['itemDeleteButton' + this.state.viewType]} /> : null)\r\n            }\r\n        </div>;\r\n    }\r\n\r\n    renderBackFolder() {\r\n        return <div key={this.state.currentDir}\r\n            id={this.state.currentDir}\r\n            onClick={e => this.changeFolder(e)}\r\n            title={this.props.t('re_Back to %s', getParentDir(this.state.currentDir))}\r\n            className={Utils.clsx(\r\n                'browserItem',\r\n                this.props.classes['item' + this.state.viewType],\r\n                this.props.classes['itemFolder' + this.state.viewType],\r\n            )}>\r\n            <IconClosed className={this.props.classes['itemFolderIcon' + this.state.viewType]} />\r\n            <IconBack className={this.props.classes.itemFolderIconBack} />\r\n\r\n            <div\r\n                className={Utils.clsx(this.props.classes['itemName' + this.state.viewType], this.props.classes['itemNameFolder' + this.state.viewType])}\r\n            >..</div>\r\n        </div>;\r\n    }\r\n\r\n    formatSize(size) {\r\n        return <div className={this.props.classes['itemSize' + this.state.viewType]}>{size || size === 0 ? Utils.formatBytes(size) : ''}</div>;\r\n    }\r\n\r\n    formatAcl(acl) {\r\n        let access = acl && (acl.permissions || acl.file);\r\n        if (access) {\r\n            access = access.toString(16).padStart(3, '0');\r\n        }\r\n\r\n        return <div className={this.props.classes['itemAccess' + this.state.viewType]}> <IconButton\r\n            onClick={() => this.setState({ modalEditOfAccess: true })}\r\n            className={this.props.classes['itemAclButton' + this.state.viewType]}>{access || '---'}</IconButton></div>;\r\n    }\r\n\r\n    getFileIcon(ext) {\r\n        switch (ext) {\r\n            case 'json':\r\n                return (<JsonIcon className={this.props.classes['itemIcon' + this.state.viewType]} />);\r\n\r\n            case 'css':\r\n                return (<CssIcon className={this.props.classes['itemIcon' + this.state.viewType]} />);\r\n\r\n            case 'js':\r\n            case 'ts':\r\n                return (<JSIcon className={this.props.classes['itemIcon' + this.state.viewType]} />);\r\n\r\n            case 'html':\r\n            case 'md':\r\n                return (<HtmlIcon className={this.props.classes['itemIcon' + this.state.viewType]} />);\r\n\r\n            case 'mp3':\r\n            case 'ogg':\r\n            case 'wav':\r\n            case 'm4a':\r\n            case 'mp4':\r\n            case 'flac':\r\n                return (<MusicIcon className={this.props.classes['itemIcon' + this.state.viewType]} />);\r\n\r\n            default:\r\n                return (<FileIcon className={this.props.classes['itemIcon' + this.state.viewType]} />);\r\n        }\r\n    }\r\n\r\n    getEditFile(ext) {\r\n        switch (ext) {\r\n            case 'json':\r\n            case 'js':\r\n            case 'html':\r\n            case 'txt':\r\n                return true;\r\n            default:\r\n                return false;\r\n        }\r\n    }\r\n\r\n    setStateBackgroundImage = () => {\r\n        let array = ['light', 'dark', 'colored', 'delete'];\r\n        this.setState(({ backgroundImage }) => {\r\n            if (array.indexOf(backgroundImage) !== -1 && array.length - 1 !== array.indexOf(backgroundImage)) {\r\n                window.localStorage.setItem('files.backgroundImage', array[array.indexOf(backgroundImage) + 1]);\r\n                return { backgroundImage: array[array.indexOf(backgroundImage) + 1] }\r\n            } else {\r\n                window.localStorage.setItem('files.backgroundImage', array[0]);\r\n                return { backgroundImage: array[0] }\r\n            }\r\n        })\r\n    }\r\n\r\n    getClassBackgroundImage = () => {\r\n        //['light', 'dark', 'colored', 'delete']\r\n        switch (this.state.backgroundImage) {\r\n            case 'light':\r\n                return this.props.classes.backgroundImageLight;\r\n            case 'dark':\r\n                return this.props.classes.backgroundImageDark;\r\n            case 'colored':\r\n                return this.props.classes.backgroundImageColored;\r\n            case 'delete':\r\n                return null;\r\n            default:\r\n                return null;\r\n        }\r\n    }\r\n\r\n    renderFile(item) {\r\n        const padding = this.state.viewType === TABLE ? item.level * this.levelPadding : 0;\r\n        const ext = Utils.getFileExtension(item.name);\r\n\r\n        return <div\r\n            key={item.id}\r\n            id={item.id}\r\n            onDoubleClick={() => {\r\n                if (!this.props.onSelect) {\r\n                    this.setState({ viewer: this.imagePrefix + item.id });\r\n                } else if (\r\n                    (!this.props.filterFiles || this.props.filterFiles.includes(item.ext)) &&\r\n                    (!this.props.filterByType || EXTENSIONS[this.props.filterByType].includes(item.ext))\r\n                ) {\r\n                    this.props.onSelect(item.id, true);\r\n                }\r\n            }}\r\n            onClick={e => this.select(item.id, e)}\r\n            style={this.state.viewType === TABLE ? { marginLeft: padding, width: 'calc(100% - ' + padding + 'px)' } : {}}\r\n            className={Utils.clsx(\r\n                'browserItem',\r\n                this.props.classes['item' + this.state.viewType],\r\n                this.props.classes['itemFile' + this.state.viewType],\r\n                this.state.selected === item.id && this.props.classes.itemSelected\r\n            )}\r\n        >\r\n            {EXTENSIONS.images.includes(ext) ?\r\n                <img\r\n                    onError={e => { e.target.onerror = null; e.target.src = NoImage }}\r\n                    className={Utils.clsx(this.props.classes['itemImage' + this.state.viewType], this.getClassBackgroundImage())}\r\n                    src={this.imagePrefix + item.id} alt={item.name}\r\n                />\r\n                :\r\n                this.getFileIcon(ext)}\r\n            <div className={this.props.classes['itemName' + this.state.viewType]}>{item.name}</div>\r\n            <Hidden xsDown>{this.formatSize(item.size)}</Hidden>\r\n            <Hidden xsDown>{this.state.viewType === TABLE ? this.formatAcl(item.acl) : null}</Hidden>\r\n            <Hidden xsDown>{this.state.viewType === TABLE && this.props.expertMode && this.getEditFile(ext) ?\r\n                <IconButton aria-label=\"delete\"\r\n                    onClick={(e) => {\r\n                        e.stopPropagation();\r\n                        if (!this.props.onSelect) {\r\n                            this.setState({ viewer: this.imagePrefix + item.id, formatEditFile: ext });\r\n                        } else if (\r\n                            (!this.props.filterFiles || this.props.filterFiles.includes(item.ext)) &&\r\n                            (!this.props.filterByType || EXTENSIONS[this.props.filterByType].includes(item.ext))\r\n                        ) {\r\n                            this.props.onSelect(item.id, true);\r\n                        }\r\n                    }}\r\n                    className={this.props.classes['itemDeleteButton' + this.state.viewType]}\r\n                >\r\n                    <EditIcon fontSize=\"small\" />\r\n                </IconButton>\r\n                :\r\n                <div className={this.props.classes['itemDeleteButton' + this.state.viewType]} />}\r\n                </Hidden>\r\n            {this.state.viewType === TABLE && this.props.allowDownload ? <IconButton\r\n                download\r\n                href={this.imagePrefix + item.id}\r\n                className={this.props.classes['itemDownloadButton' + this.state.viewType]}\r\n                onClick={e => e.stopPropagation()}\r\n            ><DownloadIcon /></IconButton> : null}\r\n\r\n            {this.state.viewType === TABLE &&\r\n                this.props.allowDelete &&\r\n                item.id !== 'vis.0/' &&\r\n                item.id !== USER_DATA &&\r\n                (this.state.expertMode || item.id.startsWith(USER_DATA) || item.id.startsWith('vis.0/'))\r\n                ?\r\n                <IconButton aria-label=\"delete\"\r\n                    onClick={e => {\r\n                        e.stopPropagation();\r\n                        if (this.suppressDeleteConfirm > Date.now()) {\r\n                            this.deleteItem(item.id);\r\n                        } else {\r\n                            this.setState({ deleteItem: item.id });\r\n                        }\r\n                    }}\r\n                    className={this.props.classes['itemDeleteButton' + this.state.viewType]}\r\n                >\r\n                    <DeleteIcon fontSize=\"small\" />\r\n                </IconButton>\r\n                :\r\n                (this.state.viewType === TABLE && this.props.allowDelete ?\r\n                    <div className={this.props.classes['itemDeleteButton' + this.state.viewType]} />\r\n                    :\r\n                    null\r\n                )\r\n            }\r\n        </div>;\r\n    }\r\n\r\n    renderItems(folderId) {\r\n        if (folderId &&\r\n            folderId !== '/' &&\r\n            !this.state.expertMode &&\r\n            folderId !== USER_DATA && !folderId.startsWith(USER_DATA) &&\r\n            folderId !== 'vis.0'   && !folderId.startsWith('vis.0/')\r\n        ) {\r\n            return null;\r\n        }\r\n\r\n        // tile\r\n        if (this.state.folders && this.state.folders[folderId]) {\r\n            if (this.state.viewType === TILE) {\r\n                const res = [];\r\n                if (folderId && folderId !== '/') {\r\n                    res.push(this.renderBackFolder())\r\n                }\r\n                this.state.folders[folderId].forEach(item => {\r\n                    if (!this.state.expertMode &&\r\n                        item.id !== USER_DATA && !item.id.startsWith(USER_DATA) &&\r\n                        item.id !== 'vis.0'   && !item.id.startsWith('vis.0/')\r\n                    ) {\r\n                        return;\r\n                    }\r\n                    if (item.folder) {\r\n                        res.push(this.renderFolder(item));\r\n                    } else if (\r\n                        (!this.props.filterFiles || this.props.filterFiles.includes(item.ext)) &&\r\n                        (!this.props.filterByType || EXTENSIONS[this.props.filterByType].includes(item.ext))\r\n                    ) {\r\n                        res.push(this.renderFile(item));\r\n                    }\r\n                });\r\n                return res;\r\n            } else {\r\n                return this.state.folders[folderId].map(item => {\r\n                    const res = [];\r\n                    if (item.id &&\r\n                        item.id !== '/' &&\r\n                        !this.state.expertMode &&\r\n                        item.id !== USER_DATA &&\r\n                        !item.id.startsWith(USER_DATA) &&\r\n                        item.id !== 'vis.0' &&\r\n                        !item.id.startsWith('vis.0/')) {\r\n                        return null;\r\n                    }\r\n\r\n                    if (item.folder) {\r\n                        const expanded = this.state.expanded.includes(item.id);\r\n\r\n                        res.push(this.renderFolder(item, expanded));\r\n                        if (this.state.folders[item.id] && expanded) {\r\n                            res.push(this.renderItems(item.id))\r\n                        }\r\n                    } else if (\r\n                        (!this.props.filterFiles || this.props.filterFiles.includes(item.ext)) &&\r\n                        (!this.props.filterByType || EXTENSIONS[this.props.filterByType].includes(item.ext))\r\n                    ) {\r\n                        res.push(this.renderFile(item));\r\n                    } else {\r\n                        return null;\r\n                    }\r\n\r\n                    return res;\r\n                });\r\n            }\r\n        } else {\r\n            return <div style={{position: 'relative'}}>\r\n                <CircularProgress key={folderId} color=\"secondary\" size={24}/>\r\n                <div style={{position: 'absolute', zIndex: 2, top: 4, width: 24, textAlign: 'center'}} >{this.state.queueLength}</div>\r\n            </div>;\r\n        }\r\n    }\r\n\r\n    renderToolbar() {\r\n        return <Toolbar key=\"toolbar\" variant=\"dense\">\r\n            {this.props.showExpertButton ? <IconButton\r\n                edge=\"start\"\r\n                title={this.props.t('ra_Toggle expert mode')}\r\n                className={Utils.clsx(this.props.classes.menuButton, this.state.expertMode && this.props.classes.menuButtonExpertActive)}\r\n                aria-label=\"expert mode\"\r\n                onClick={() => this.setState({ expertMode: !this.state.expertMode })}\r\n            ><ExpertIcon /></IconButton> : null}\r\n            {this.props.showViewTypeButton ? <IconButton\r\n                edge=\"start\"\r\n                title={this.props.t('ra_Toggle view mode')}\r\n                className={this.props.classes.menuButton}\r\n                aria-label=\"view mode\"\r\n                onClick={() => {\r\n                    const viewType = this.state.viewType === TABLE ? TILE : TABLE;\r\n                    window.localStorage.setItem('files.viewType', viewType);\r\n                    let currentDir = this.state.selected;\r\n                    if (isFile(currentDir)) {\r\n                        currentDir = getParentDir(currentDir)\r\n                    }\r\n                    this.setState({ viewType, currentDir }, () => {\r\n                        if (this.state.viewType === TABLE) {\r\n                            this.scrollToSelected();\r\n                        }\r\n                    });\r\n                }}\r\n            >{this.state.viewType !== TABLE ? <IconList /> : <IconTile />}</IconButton> : null}\r\n            <IconButton\r\n                edge=\"start\"\r\n                title={this.props.t('ra_Hide empty folders')}\r\n                className={this.props.classes.menuButton}\r\n                color={this.state.filterEmpty ? 'secondary' : 'inherit'}\r\n                aria-label=\"filter empty\"\r\n                onClick={() => {\r\n                    window.localStorage.setItem('file.empty', !this.state.filterEmpty);\r\n                    this.setState({ filterEmpty: !this.state.filterEmpty });\r\n                }}\r\n            ><EmptyFilterIcon /></IconButton>\r\n            <IconButton\r\n                edge=\"start\"\r\n                title={this.props.t('ra_Reload files')}\r\n                className={this.props.classes.menuButton}\r\n                color={'inherit'}\r\n                aria-label=\"filter empty\"\r\n                onClick={() => this.setState({ folders: {} }, () => this.loadFolders())}\r\n            ><RefreshIcon /></IconButton>\r\n            {this.props.allowCreateFolder ? <IconButton\r\n                edge=\"start\"\r\n                disabled={this.state.expertMode ? !this.state.selected : !this.state.selected.startsWith('vis.0') && !this.state.selected.startsWith(USER_DATA)}\r\n                title={this.props.t('ra_Create folder')}\r\n                className={this.props.classes.menuButton}\r\n                color={'inherit'}\r\n                aria-label=\"add folder\"\r\n                onClick={() => this.setState({ addFolder: true })}\r\n            ><AddFolderIcon /></IconButton> : null}\r\n            {this.props.allowUpload ? <IconButton\r\n                edge=\"start\"\r\n                disabled={this.state.expertMode ? !this.state.selected : !this.state.selected.startsWith('vis.0') && !this.state.selected.startsWith(USER_DATA)}\r\n                title={this.props.t('ra_Upload file')}\r\n                className={this.props.classes.menuButton}\r\n                color={'inherit'}\r\n                aria-label=\"upload file\"\r\n                onClick={() =>\r\n                    this.setState({uploadFile: true})}\r\n            ><UploadIcon /></IconButton> : null}\r\n            <Tooltip title={this.props.t('Background image')}>\r\n                <IconButton\r\n                    color={'inherit'}\r\n                    edge=\"start\"\r\n                    className={this.props.classes.menuButton}\r\n                    onClick={this.setStateBackgroundImage}\r\n                >\r\n                    <Brightness5Icon />\r\n                </IconButton>\r\n            </Tooltip>\r\n        </Toolbar>;\r\n    }\r\n\r\n    findItem(id, folders) {\r\n        folders = folders || this.state.folders;\r\n        const parts = id.split('/');\r\n        parts.pop();\r\n        const parentFolder = parts.join('/');\r\n        return folders[parentFolder || '/'].find(item => item.id === id);\r\n    }\r\n\r\n    renderInputDialog() {\r\n        if (this.state.addFolder) {\r\n            let parentFolder = this.findFirstFolder(this.state.selected);\r\n\r\n            if (!parentFolder) {\r\n                return window.alert(this.props.t('ra_Invalid parent folder!'));\r\n            }\r\n\r\n            return <TextInputDialog\r\n                key=\"inputDialog\"\r\n                applyText={this.props.t('ra_Create')}\r\n                cancelText={this.props.t('ra_Cancel')}\r\n                titleText={this.props.t('ra_Create new folder in %s', this.state.selected)}\r\n                promptText={this.props.t('ra_If no file will be created in the folder, it will disappear after the browser closed')}\r\n                labelText={this.props.t('ra_Folder name')}\r\n                verify={text => this.state.folders[parentFolder].find(item => item.name === text) ? '' : this.props.t('ra_Duplicate name')}\r\n                onClose={name => {\r\n                    if (name) {\r\n                        const folders = {};\r\n                        Object.keys(this.state.folders).forEach(folder => folders[folder] = this.state.folders[folder]);\r\n                        const parent = this.findItem(parentFolder);\r\n                        folders[parentFolder].push({\r\n                            id: parentFolder + '/' + name,\r\n                            level: parent.level + 1,\r\n                            name,\r\n                            folder: true,\r\n                            temp: true,\r\n                        });\r\n\r\n                        folders[parentFolder].sort(sortFolders);\r\n\r\n                        folders[parentFolder + '/' + name] = [];\r\n                        const expanded = [...this.state.expanded];\r\n                        if (!expanded.includes(parentFolder)) {\r\n                            expanded.push(parentFolder);\r\n                            expanded.sort();\r\n                        }\r\n                        this.setState({ addFolder: false, folders, expanded });\r\n                    } else {\r\n                        this.setState({ addFolder: false });\r\n                    }\r\n                }}\r\n                replace={text => text.replace(/[^-_\\w\\d]/, '_')}\r\n            />;\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    componentDidUpdate(prevProps, prevState, snapshot) {\r\n        this.setOpacityTimer && clearTimeout(this.setOpacityTimer);\r\n        this.setOpacityTimer = setTimeout(() => {\r\n            this.setOpacityTimer = null;\r\n            const items = window.document.getElementsByClassName('browserItem');\r\n            for (let i = 0; i < items.length; i++) {\r\n                items[i].style.opacity = 1;\r\n            }\r\n        }, 100);\r\n    }\r\n\r\n    uploadFile(fileName, data) {\r\n        const parts = fileName.split('/');\r\n        const adapter = parts.shift();\r\n        return this.props.socket.writeFile64(adapter, parts.join('/'), data)\r\n            .catch(e => window.alert('Cannot write file: ' + e));\r\n    }\r\n\r\n    findFirstFolder(id) {\r\n        let parentFolder = id;\r\n        // find folder\r\n        if (!this.findItem(parentFolder).folder) {\r\n            const parts = parentFolder.split('/');\r\n            parts.pop();\r\n            parentFolder = '';\r\n            while (parts.length) {\r\n                const item = this.findItem(parts.join('/'));\r\n                if (item && item.folder) {\r\n                    parentFolder = parts.join('/');\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return parentFolder;\r\n    }\r\n\r\n    renderUpload() {\r\n        if (this.state.uploadFile) {\r\n            return [\r\n                <Fab key=\"close\" color=\"primary\" aria-label=\"close\" className={this.props.classes.uploadCloseButton}\r\n                    onClick={() => this.setState({ uploadFile: false })}>\r\n                    <CloseIcon />\r\n                </Fab>,\r\n                <Dropzone\r\n                    key=\"dropzone\"\r\n                    onDragEnter={() => this.setState({ uploadFile: 'dragging' })}\r\n                    onDragLeave={() => this.setState({ uploadFile: true })}\r\n                    onDrop={acceptedFiles => {\r\n                        let count = acceptedFiles.length;\r\n                        acceptedFiles.forEach(file => {\r\n                            const reader = new FileReader();\r\n\r\n                            reader.onabort = () => console.log('file reading was aborted');\r\n                            reader.onerror = () => console.log('file reading has failed');\r\n                            reader.onload  = () => {\r\n                                let parentFolder = this.findFirstFolder(this.state.selected);\r\n\r\n                                if (!parentFolder) {\r\n                                    return window.alert(this.props.t('ra_Invalid parent folder!'));\r\n                                }\r\n\r\n                                this.uploadFile(parentFolder + '/' + file.name, reader.result)\r\n                                    .then(() => {\r\n                                        if (!--count) {\r\n                                            const folders = {};\r\n                                            Object.keys(this.state.folders).forEach(name => {\r\n                                                if (name !== parentFolder && !name.startsWith(parentFolder + '/')) {\r\n                                                    folders[name] = this.state.folders[name];\r\n                                                }\r\n                                            });\r\n                                            this.setState({ uploadFile: false, folders }, () =>\r\n                                                this.browseFolders([...this.state.expanded], folders)\r\n                                                    .then(folders => this.setState({ folders })));\r\n                                        }\r\n                                    });\r\n                            };\r\n\r\n                            reader.readAsArrayBuffer(file);\r\n                        });\r\n                    }}\r\n                >\r\n                    {({ getRootProps, getInputProps }) => (\r\n                        <div className={Utils.clsx(this.props.classes.uploadDiv, this.state.uploadFile === 'dragging' && this.props.classes.uploadDivDragging)}\r\n                            {...getRootProps()}>\r\n                            <input {...getInputProps()} />\r\n                            <div className={this.props.classes.uploadCenterDiv}>\r\n                                <div className={this.props.classes.uploadCenterTextAndIcon}>\r\n                                    <UploadIcon className={this.props.classes.uploadCenterIcon} />\r\n                                    <div className={this.props.classes.uploadCenterText}>{\r\n                                        this.state.uploadFile === 'dragging' ? this.props.t('ra_Drop file here') :\r\n                                            this.props.t('ra_Place your files here or click here to open the browse dialog')}</div>\r\n                                </div>\r\n                            </div>\r\n                        </div>)}\r\n                </Dropzone>\r\n            ];\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    deleteRecursive(id) {\r\n        const item = this.findItem(id);\r\n        if (item.folder) {\r\n            return Promise.all(this.state.folders[id].map(item => this.deleteRecursive(item.id)));\r\n        } else {\r\n            const parts = id.split('/');\r\n            const adapter = parts.shift();\r\n            if (parts.length) {\r\n                return this.props.socket.deleteFile(adapter, parts.join('/'))\r\n                    .catch(e => window.alert('Cannot delete file: ' + e));\r\n            } else {\r\n                return Promise.resolve();\r\n            }\r\n        }\r\n    }\r\n\r\n    deleteItem(deleteItem) {\r\n        deleteItem = deleteItem || this.state.deleteItem;\r\n\r\n        this.setState({ deleteItem: '' }, () =>\r\n            this.deleteRecursive(deleteItem)\r\n                .then(() => {\r\n                    let parentFolder = this.findFirstFolder(deleteItem);\r\n                    const folders = {};\r\n                    Object.keys(this.state.folders).forEach(name => {\r\n                        if (name !== parentFolder && !name.startsWith(parentFolder + '/')) {\r\n                            folders[name] = this.state.folders[name];\r\n                        }\r\n                    });\r\n                    this.setState({ folders }, () =>\r\n                        this.browseFolders([...this.state.expanded], folders)\r\n                            .then(folders => this.setState({ folders })));\r\n                })\r\n        );\r\n    }\r\n\r\n    renderDeleteDialog() {\r\n        if (this.state.deleteItem) {\r\n            return <Dialog key=\"deleteDialog\" open={true} onClose={() => this.setState({ deleteItem: '' })} aria-labelledby=\"form-dialog-title\">\r\n                <DialogTitle id=\"form-dialog-title\">{this.props.t('ra_Confirm deletion of %s', this.state.deleteItem.split('/').pop())}</DialogTitle>\r\n                <DialogContent>\r\n                    <DialogContentText>\r\n                        {this.props.t('ra_Are you sure?')}\r\n                    </DialogContentText>\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button variant=\"contained\" onClick={() => {\r\n                        this.suppressDeleteConfirm = Date.now() + 60000 * 5;\r\n                        this.deleteItem();\r\n                    }} >{this.props.t('ra_Delete (no confirm for 5 mins)')}</Button>\r\n                    <Button variant=\"contained\" onClick={() => this.deleteItem()} color=\"primary\" autoFocus>{this.props.t('ra_Delete')}</Button>\r\n                    <Button variant=\"contained\" onClick={() => this.setState({ deleteItem: '' })} >{this.props.t('ra_Cancel')}</Button>\r\n                </DialogActions>\r\n            </Dialog>;\r\n        } else {\r\n            return false;\r\n        }\r\n    }\r\n\r\n    renderViewDialog() {\r\n        return this.state.viewer ? <FileViewer\r\n            key={this.state.viewer}\r\n            href={this.state.viewer}\r\n            formatEditFile={this.state.formatEditFile}\r\n            themeName={this.props.themeName}\r\n            setStateBackgroundImage={this.setStateBackgroundImage}\r\n            getClassBackgroundImage={this.getClassBackgroundImage}\r\n            t={this.props.t}\r\n            socket={this.props.socket}\r\n            lang={this.props.lang}\r\n            expertMode={this.state.expertMode}\r\n            onClose={() => this.setState({ viewer: '', formatEditFile: '' })}\r\n        /> : null;\r\n    }\r\n\r\n    renderError() {\r\n        if (this.state.errorText) {\r\n            return <ErrorDialog key=\"errorDialog\" text={this.state.errorText} onClose={() => this.setState({ errorText: '' })} />;\r\n        } else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    updateItemsAcl(info) {\r\n        const folders = JSON.parse(JSON.stringify(this.state.folders));\r\n        let changed;\r\n        info.forEach(it => {\r\n            const item = this.findItem(it.id, folders);\r\n            if (item && JSON.stringify(item.acl) !== JSON.stringify(it.acl)) {\r\n                item.acl = it.acl;\r\n                changed = true;\r\n            }\r\n        });\r\n        changed && this.setState({ folders });\r\n    }\r\n\r\n    changeToPath() {\r\n        setTimeout(() => {\r\n            if (this.state.path !== this.state.selected && (!this.lastSelect || Date.now() - this.lastSelect > 100)) {\r\n                let folder = this.state.path;\r\n                if (isFile(this.state.path)) {\r\n                    folder = getParentDir(this.state.path);\r\n                }\r\n                return new Promise(resolve => {\r\n                    if (!this.state.folders[folder]) {\r\n                        return this.browseFolder(folder)\r\n                            .then(folders => this.setState({ folders }, () => resolve(true)))\r\n                            .catch(err => this.setState({ errorText: err === NOT_FOUND ? this.props.t('re_Cannot find \"%s\"', folder) : this.props.t('re_Cannot read \"%s\"', folder) }));\r\n                    } else {\r\n                        return resolve(true);\r\n                    }\r\n                })\r\n                    .then(result =>\r\n                        result && this.setState({ selected: this.state.path, currentDir: folder, pathFocus: false }));\r\n            } else if (!this.lastSelect || Date.now() - this.lastSelect > 100) {\r\n                this.setState({ pathFocus: false });\r\n            }\r\n        }, 100);\r\n    }\r\n\r\n    renderBreadcrumb() {\r\n        const parts = this.state.selected.startsWith('/') ? this.state.selected.split('/') : ('/' + this.state.selected).split('/');\r\n        const p = [];\r\n        return parts.map((part, i) => {\r\n            part && p.push(part);\r\n            const path = p.join('/');\r\n            if (i < parts.length - 1) {\r\n                return [\r\n                    <div key={this.state.selected + '_' + i} className={this.props.classes.pathDivBreadcrumbDir} onClick={e => this.changeFolder(e, path || '/')}>\r\n                        {part || this.props.t('re_Root')}\r\n                    </div>,\r\n                    <span key={this.state.selected + '_s_' + i} className={this.props.classes.pathDivBreadcrumbSlash}>{'>'}</span>];\r\n            } else {\r\n                return <div key={this.state.selected + '_' + i} className={this.props.classes.pathDivBreadcrumbFile} onClick={() => this.setState({ pathFocus: true })}>{part}</div>;\r\n            }\r\n        });\r\n    }\r\n\r\n    renderPath() {\r\n        return <div key=\"path\" className={Utils.clsx(this.props.classes.pathDiv, !this.state.pathFocus && this.props.classes.pathDivBreadcrumb)}>\r\n            {this.state.pathFocus ?\r\n                <Input\r\n                    value={this.state.path}\r\n                    onKeyDown={e => e.keyCode === 13 && this.changeToPath()}\r\n                    onBlur={e => this.changeToPath()}\r\n                    onChange={e => this.setState({ path: e.target.value })}\r\n                    className={this.props.classes.pathDivInput}\r\n                />\r\n                :\r\n                this.renderBreadcrumb()\r\n            }\r\n        </div>;\r\n    }\r\n\r\n    render() {\r\n        if (!this.props.ready) {\r\n            return <LinearProgress key={this.props.key ? this.props.key + '_c' : 'c'} />;\r\n        }\r\n\r\n        return <div key={this.props.key} style={this.props.style} className={Utils.clsx(this.props.classes.root, this.props.className)}>\r\n            {this.props.showToolbar ? this.renderToolbar() : null}\r\n            {this.state.viewType === TILE ? this.renderPath() : null}\r\n            <div key=\"items\" className={Utils.clsx(this.props.classes.filesDiv, this.props.classes['filesDiv' + this.state.viewType])}>\r\n                {this.state.viewType === TABLE ? this.renderItems('/') : this.renderItems(this.state.currentDir || '/')}\r\n            </div>\r\n            {this.props.allowUpload ? this.renderInputDialog() : null}\r\n            {this.props.allowUpload ? this.renderUpload() : null}\r\n            {this.props.allowDelete ? this.renderDeleteDialog() : null}\r\n            {this.props.allowView ? this.renderViewDialog() : null}\r\n            {this.state.modalEditOfAccess && this.props.modalEditOfAccessControl && this.props.modalEditOfAccessControl(this, this.state.modalEditOfAccessObjData)}\r\n            {this.renderError()}\r\n        </div>;\r\n    }\r\n}\r\n\r\nFileBrowser.defaultProps = {\r\n    objectAddBoolean: false,\r\n    objectEditBoolean: false,\r\n    objectStatesView: false,\r\n    objectImportExport: false,\r\n    objectEditOfAccessControl: false,\r\n    modalNewObject: () => { },\r\n    modalEditOfAccessControl: () => { },\r\n}\r\n\r\nFileBrowser.propTypes = {\r\n    key: PropTypes.string,\r\n    style: PropTypes.object,\r\n    className: PropTypes.string,\r\n    t: PropTypes.func,\r\n    lang: PropTypes.string,\r\n    socket: PropTypes.object,\r\n    ready: PropTypes.bool,\r\n    expertMode: PropTypes.bool,\r\n    showToolbar: PropTypes.bool,\r\n    allowUpload: PropTypes.bool,\r\n    allowDownload: PropTypes.bool,\r\n    allowCreateFolder: PropTypes.bool,\r\n    allowDelete: PropTypes.bool,\r\n    allowView: PropTypes.bool,\r\n    imagePrefix: PropTypes.string,\r\n    showExpertButton: PropTypes.bool,\r\n    viewType: PropTypes.string,\r\n    showViewTypeButton: PropTypes.bool,\r\n\r\n    selected: PropTypes.string,\r\n    tileView: PropTypes.bool,\r\n    filterFiles: PropTypes.array, // like ['png', 'svg', 'bmp', 'jpg', 'jpeg']\r\n    filterByType: PropTypes.string, // images, code or txt from FileViewer.EXTENSIONS\r\n    onSelect: PropTypes.func, // function (id, isDoubleClick)\r\n};\r\n\r\n/** @type {typeof FileBrowser} */\r\nconst _export = withWidth()(withStyles(styles)(FileBrowser));\r\nexport default _export;"],"file":"FileBrowser.js"}