(this["webpackJsonpsrc-rx"]=this["webpackJsonpsrc-rx"]||[]).push([[14],{1841:function(e,t,s){"use strict";(function(e){var i=s(11),r=s(12),a=s(14),n=s(15),o=s(0),l=s(8),c=s(320),d=s(6),p=s(347),u=s.n(p),h=(s(524),s(525),s(526),s(527),s(528),s(113)),f=s(226),m=s(227),v=s(228),b=s(277),g=s(181),j=s(1585),w=s(60),x=s.n(w),y=s(187),O=s(554),k=s.n(O),S=s(48),T=s.n(S),F=s(1548),I=s.n(F),D=s(3),C={images:["png","jpg","svg","jpeg","jpg","bmp"],code:["js","json","md"],txt:["log","txt","html","css","xml"]},N=function(t){Object(a.a)(o,t);var s=Object(n.a)(o);function o(t){var r;if(Object(i.a)(this,o),(r=s.call(this,t)).writeFile64=function(){var t=r.props.href.split("/"),s=r.state.editingValue;t.splice(0,2);var i=t[0],a=t.splice(1).join("/");r.props.socket.writeFile64(i,a,e.from(s).toString("base64")).then((function(e){return r.props.onClose()})).catch((function(e){return window.alert("Cannot write file: "+e)}))},r.ext=x.a.getFileExtension(r.props.href),r.state={text:null,code:null,editing:!!r.props.formatEditFile||!1,editingValue:null,copyPossible:C.code.includes(r.ext)||C.txt.includes(r.ext)},r.state.copyPossible){var a=r.props.href.split("/");a.splice(0,2);var n=a[0],l=a.splice(1).join("/");r.props.socket.readFile(n,l).then((function(e){C.txt.includes(r.ext)?r.setState({text:e,editingValue:e}):C.code.includes(r.ext)&&r.setState({code:e,editingValue:e})})).catch((function(e){return window.alert("Cannot read file: "+e)}))}return r}return Object(r.a)(o,[{key:"getEditFile",value:function(e){switch(e){case"json":return"json";case"js":return"javascript";case"html":case"txt":return"html";default:return"json"}}},{key:"getContent",value:function(){var e=this;return C.images.includes(this.ext)?Object(D.jsx)("img",{onError:function(e){e.target.onerror=null,e.target.src=j.default},className:Object(d.default)(this.props.classes.img,this.props.getClassBackgroundImage()),src:this.props.href,alt:this.props.href}):null!==this.state.code||null!==this.state.text||this.state.editing?Object(D.jsx)(u.a,{mode:this.getEditFile(this.props.formatEditFile),width:"100%",height:"100%",theme:"dark"===this.props.themeName?"clouds_midnight":"chrome",value:this.state.editingValue||this.state.code||this.state.text,onChange:function(t){return e.setState({editingValue:t})},name:"UNIQUE_ID_OF_DIV",readOnly:!this.state.editing,fontSize:14,setOptions:{enableBasicAutocompletion:!0,enableLiveAutocompletion:!0,enableSnippets:!0},editorProps:{$blockScrolling:!0}}):void 0}},{key:"render",value:function(){var e=this;return Object(D.jsxs)(f.a,{classes:{scrollPaper:this.props.classes.dialog,paper:this.props.classes.paper},scroll:"paper",open:!!this.props.href,onClose:function(){return e.props.onClose()},fullWidth:!0,maxWidth:"xl","aria-labelledby":"form-dialog-title",children:[Object(D.jsxs)("div",{className:this.props.classes.dialogTitle,children:[Object(D.jsx)(b.a,{id:"form-dialog-title",children:this.props.t(this.state.editing?"Edit":"View")+": "+this.props.href}),C.images.includes(this.ext)&&Object(D.jsx)("div",{children:Object(D.jsx)(g.a,{color:"inherit",onClick:this.props.setStateBackgroundImage,children:Object(D.jsx)(k.a,{})})})]}),Object(D.jsx)(v.a,{className:this.props.classes.content,children:this.getContent()}),Object(D.jsxs)(m.a,{children:[this.state.copyPossible?Object(D.jsx)(h.a,{onClick:function(t){return x.a.copyToClipboard(e.state.text||e.state.code,t)},startIcon:Object(D.jsx)(y.FaCopy,{}),children:this.props.t("Copy content")}):null,this.state.editing?Object(D.jsx)(h.a,{disabled:this.state.editingValue===this.state.code||this.state.editingValue===this.state.text,variant:"contained",onClick:this.writeFile64,startIcon:Object(D.jsx)(I.a,{}),children:this.props.t("Save")}):null,Object(D.jsx)(h.a,{variant:"contained",onClick:function(){return e.props.onClose()},color:"primary",startIcon:Object(D.jsx)(T.a,{}),children:this.props.t("Close")})]})]},this.props.key)}}]),o}(o.Component);t.a=Object(c.a)()(Object(l.a)((function(e){return{dialog:{height:"100%"},paper:{height:"calc(100% - 64px)"},content:{textAlign:"center"},textarea:{width:"100%",height:"100%"},img:{width:"auto",height:"calc(100% - 5px)",objectFit:"contain"},dialogTitle:{justifyContent:"space-between",display:"flex"}}}))(N))}).call(this,s(1842).Buffer)},2022:function(e,t,s){"use strict";s.r(t);var i=s(29),r=s.n(i),a=s(49),n=s(11),o=s(12),l=s(14),c=s(15),d=s(0),p=s(747),u=s(17),h=s(81),f=s(320),m=s(8),v=s(377),b=s(637),g=s(758),j=s(181),w=s(633),x=s(226),y=s(277),O=s(228),k=s(490),S=s(227),T=s(113),F=s(401),I=s(1501),D=s(278),C=s(559),N=s.n(C),B=s(60),E=s.n(B),A=s(1839),L=s.n(A),_=s(1840),P=s(1841),z=s(207),M=s.n(z),W=s(48),G=s.n(W),R=s(1846),V=s.n(R),J=s(1847),U=s.n(J),q=s(522),X=s.n(q),H=s(426),Y=s.n(H),K=s(751),Q=s.n(K),$=s(1587),Z=s.n($),ee=s(292),te=s.n(ee),se=s(1848),ie=s.n(se),re=s(1584),ae=s.n(re),ne=s(1849),oe=s.n(ne),le=s(551),ce=s.n(le),de=s(531),pe=s.n(de),ue=s(535),he=s.n(ue),fe=s(1586),me=s.n(fe),ve=s(185),be=s.n(ve),ge=s(554),je=s.n(ge),we=s(301),xe=s.n(we),ye=s(1585),Oe=s(756),ke=s.n(Oe),Se=s(757),Te=s.n(Se),Fe=s(3),Ie=32,De=120,Ce="Not found",Ne="0_userdata.0";function Be(e,t){return e.folder&&t.folder?e.name>t.name?1:e.name<t.name?-1:0:e.folder?-1:t.folder||e.name>t.name?1:e.name<t.name?-1:0}function Ee(e){var t=(e||"").split("/");return t.length&&t.pop(),t.join("/")}function Ae(e){var t=E.a.getFileExtension(e);return!!(t&&t.toLowerCase().match(/[a-z]+/)&&t.length<5)}var Le="Table",_e="Tile",Pe=function(e){Object(l.a)(s,e);var t=Object(c.a)(s);function s(e){var i;Object(n.a)(this,s),(i=t.call(this,e)).setStateBackgroundImage=function(){var e=["light","dark","colored","delete"];i.setState((function(t){var s=t.backgroundImage;return-1!==e.indexOf(s)&&e.length-1!==e.indexOf(s)?(window.localStorage.setItem("files.backgroundImage",e[e.indexOf(s)+1]),{backgroundImage:e[e.indexOf(s)+1]}):(window.localStorage.setItem("files.backgroundImage",e[0]),{backgroundImage:e[0]})}))},i.getClassBackgroundImage=function(){switch(i.state.backgroundImage){case"light":return i.props.classes.backgroundImageLight;case"dark":return i.props.classes.backgroundImageDark;case"colored":return i.props.classes.backgroundImageColored;case"delete":default:return null}};var r,a=window.localStorage.getItem("files.expanded")||"[]";try{a=JSON.parse(a)}catch(d){a=[]}r=i.props.showViewTypeButton&&window.localStorage.getItem("files.viewType")||Le;var o=i.props.selected||window.localStorage.getItem("files.selected")||Ne,l="";l=Ae(o)?Ee(o):o;var c=window.localStorage.getItem("files.backgroundImage")||null;return i.state={viewType:r,folders:{},filterEmpty:"false"!==window.localStorage.getItem("files.empty"),expanded:a,currentDir:l,expertMode:i.props.expertMode,addFolder:!1,uploadFile:!1,deleteItem:"",marked:[],viewer:"",formatEditFile:"",path:o,selected:o,errorText:"",modalEditOfAccess:!1,backgroundImage:c,queueLength:0,loadAllFolders:!1,allFoldersLoaded:!1},i.imagePrefix=i.props.imagePrefix||"./files/",i.levelPadding=i.props.levelPadding||20,i.mounted=!0,i.suppressDeleteConfirm=0,i.browseList=[],i.browseListRunning=!1,i.initialReadFinished=!1,i}return Object(o.a)(s,[{key:"loadFolders",value:function(){var e=this;return this.initialReadFinished=!1,this.browseFolder("/").then((function(t){return e.state.viewType===Le?e.browseFolders(Object(h.a)(e.state.expanded),t):e.state.currentDir&&"/"!==e.state.currentDir?e.browseFolder(e.state.currentDir,t):Promise.resolve(t)})).then((function(t){return e.setState({folders:t},(function(){if(e.state.viewType!==Le||e.findItem(e.state.selected))e.scrollToSelected();else{for(var t,s=e.state.selected.split("/");s.length&&!e.findItem(s.join("/"));)s.pop();t=s.length?s.join("/"):Ne,e.setState({selected:t,path:t,pathFocus:!1},(function(){return e.scrollToSelected()}))}e.initialReadFinished=!0}))}))}},{key:"scrollToSelected",value:function(){if(this.mounted){var e=document.getElementById(this.state.selected);e&&e.scrollIntoView()}}},{key:"componentDidMount",value:function(){this.mounted=!0,this.loadFolders()}},{key:"componentWillUnmount",value:function(){this.mounted=!1,this.browseList=null,this.browseListRunning=!1}},{key:"browseFolders",value:function(e,t,s){var i=this;if(t||(t={},Object.keys(this.state.folders).forEach((function(e){return t[e]=i.state.folders[e]}))),!s)return new Promise((function(s){return i.browseFolders(e,t,s)}));e&&e.length?this.browseFolder(e.shift(),t).then((function(){return setTimeout((function(){return i.browseFolders(e,t,s)}),0)})).catch((function(){return setTimeout((function(){return i.browseFolders(e,t,s)}),0)})):s(t)}},{key:"readDirSerial",value:function(e,t){var s=this;return new Promise((function(i,r){s.browseList&&(s.browseList.push({resolve:i,reject:r,adapter:e,relPath:t}),!s.browseListRunning&&s.processBrowseList())}))}},{key:"processBrowseList",value:function(e){var t=this;!this.browseListRunning&&this.browseList&&this.browseList.length&&(this.browseListRunning=!0,this.browseList.length>10&&this.browseList.length%10||this.setState({queueLength:this.browseList.length}),this.browseList[0].processing=!0,this.props.socket.readDir(this.browseList[0].adapter,this.browseList[0].relPath).then((function(s){if(t.browseList){var i=t.browseList.shift();if(i){var r=i.resolve;i.resolve=null,i.reject=null,i.adapter=null,i.relPath=null,r(s),t.browseListRunning=!1,t.browseList.length?e<5?t.processBrowseList(e+1):setTimeout((function(){return t.processBrowseList(0)}),0):t.setState({queueLength:0})}else t.setState({queueLength:0})}})).catch((function(s){if(t.browseList){var i=t.browseList.shift();if(i){var r=i.reject;i.resolve=null,i.reject=null,i.adapter=null,i.relPath=null,r(s),t.browseListRunning=!1,t.browseList.length?e<5?t.processBrowseList(e+1):setTimeout((function(){return t.processBrowseList(0)}),0):t.setState({queueLength:0})}else t.setState({queueLength:0})}})))}},{key:"browseFolder",value:function(e,t,s){var i=this;if(t||(t={},Object.keys(this.state.folders).forEach((function(e){return t[e]=i.state.folders[e]}))),t[e])return s?Promise.resolve(t):new Promise((function(s,r){return Promise.all(t[e].filter((function(e){return e.folder})).map((function(e){return i.browseFolder(e.id,t,!0).catch((function(e){}))}))).then((function(){return s(t)})).catch((function(e){return r(e)}))}));if(e&&"/"!==e){var r=e.split("/"),a=r.length,n=r.shift(),o=r.join("/");return this.readDirSerial(n,o).then((function(r){var n=[];return r.forEach((function(t){var s={id:e+"/"+t.file,ext:E.a.getFileExtension(t.file),folder:t.isDir,name:t.file,size:t.stats&&t.stats.size,modified:t.modifiedAt,acl:t.acl,level:a};n.push(s)})),n.sort(Be),t[e]=n,s?t:Promise.all(n.filter((function(e){return e.folder})).map((function(e){return i.browseFolder(e.id,t,!0)}))).then((function(){return t}))})).catch((function(s){return i.initialReadFinished&&window.alert("Cannot read ".concat(n).concat(o?"/"+o:"",": ").concat(s)),t[e]=[],t}))}return this.props.socket.readMetaItems().then((function(r){var a=[],n=null;return r=r.filter((function(e){return i.state.expertMode?e._id.split(".").length<=2:"0_userdata.0"===e._id||"vis.0"===e._id})),i.state.expertMode&&i.setState({allFoldersLoaded:!0,loadFolders:!1}),r.forEach((function(e){var t={id:e._id,name:e._id,title:e.common&&e.common.name||e._id,meta:!0,from:e.from,ts:e.ts,color:e.common&&e.common.color,icon:e.common&&e.common.icon,folder:!0,acl:e.acl,level:0};t.id===Ne?n=t:a.push(t)})),a.sort((function(e,t){return e.id>t.id?1:e.id<t.id?-1:0})),a.unshift(n),t[e||"/"]=a,s?t:Promise.all(a.filter((function(e){return e.folder})).map((function(e){return i.browseFolder(e.id,t,!0).catch((function(e){}))}))).then((function(){return t}))})).catch((function(e){return i.initialReadFinished&&window.alert("Cannot read meta items: "+e)}))}},{key:"toggleFolder",value:function(e,t){var s=this;t&&t.stopPropagation();var i=Object(h.a)(this.state.expanded),r=i.indexOf(e.id);if(-1===r){if(i.push(e.id),i.sort(),window.localStorage.setItem("files.expanded",JSON.stringify(i)),!e.temp)return this.browseFolder(e.id).then((function(e){return s.setState({expanded:i,folders:e})})).catch((function(t){return window.alert(t===Ce?s.props.t('re_Cannot find "%s"',e.id):s.props.t('re_Cannot read "%s"',e.id))}));this.setState({expanded:i})}else i.splice(r,1),window.localStorage.setItem("files.expanded",JSON.stringify(i)),this.setState({expanded:i})}},{key:"changeFolder",value:function(e,t){var s=this;if(e&&e.stopPropagation(),this.lastSelect=Date.now(),"/"===(t=t||Ee(this.state.currentDir))&&(t=""),window.localStorage.setItem("files.currentDir",t),t&&!this.state.folders[t])return this.browseFolder(t).then((function(e){return s.setState({folders:e,path:t,currentDir:t,selected:t,pathFocus:!1},(function(){return s.props.onSelect&&s.props.onSelect("")}))}));this.setState({currentDir:t,selected:t,path:t,pathFocus:!1},(function(){return s.props.onSelect&&s.props.onSelect("")}))}},{key:"select",value:function(e,t,s){var i=this;"function"===typeof t&&(s=t,t=null),t&&t.stopPropagation(),this.lastSelect=Date.now(),window.localStorage.setItem("files.selected",e),this.setState({selected:e,path:e,pathFocus:!1},(function(){if(i.props.onSelect){var t=E.a.getFileExtension(e);i.props.filterFiles&&!i.props.filterFiles.includes(t)||i.props.filterByType&&!_.EXTENSIONS[i.props.filterByType].includes(t)?i.props.onSelect(""):i.props.onSelect(e)}s&&s()}))}},{key:"renderFolder",value:function(e,t){var s=this;if(this.state.filterEmpty&&(!this.state.folders[e.id]||!this.state.folders[e.id].length)&&e.id!==Ne&&!e.temp)return null;var i=t?Te.a:ke.a,r=this.state.viewType===Le?e.level*this.levelPadding:0;return Object(Fe.jsxs)("div",{id:e.id,style:this.state.viewType===Le?{marginLeft:r,width:"calc(100% - "+r+"px"}:{},onClick:function(t){return s.state.viewType===Le?s.select(e.id,t):s.changeFolder(t,e.id)},onDoubleClick:function(t){return s.state.viewType===Le&&s.toggleFolder(e,t)},title:e.title&&"object"===typeof e.title?e.title[this.props.lang]||e.title.end||"":e.title||null,className:E.a.clsx("browserItem",this.props.classes["item"+this.state.viewType],this.props.classes["itemFolder"+this.state.viewType],this.state.selected===e.id&&this.props.classes.itemSelected,e.temp&&this.props.classes.itemFolderTemp),children:[Object(Fe.jsx)(i,{className:this.props.classes["itemFolderIcon"+this.state.viewType],onClick:this.state.viewType===Le?function(t){return s.toggleFolder(e,t)}:void 0}),Object(Fe.jsx)("div",{className:E.a.clsx(this.props.classes["itemName"+this.state.viewType],this.props.classes["itemNameFolder"+this.state.viewType]),children:e.name===Ne?this.props.t("ra_User files"):e.name}),Object(Fe.jsx)(I.a,{xsDown:!0,children:Object(Fe.jsx)("div",{className:this.props.classes["itemSize"+this.state.viewType],children:this.state.viewType===Le&&this.state.folders[e.id]?this.state.folders[e.id].length:""})}),Object(Fe.jsx)(I.a,{xsDown:!0,children:this.state.viewType===Le?this.formatAcl(e.acl):null}),Object(Fe.jsx)(I.a,{xsDown:!0,children:this.state.viewType===Le&&this.props.expertMode&&Object(Fe.jsx)("div",{className:this.props.classes["itemDeleteButton"+this.state.viewType]})}),this.state.viewType===Le&&this.props.allowDownload?Object(Fe.jsx)("div",{className:this.props.classes["itemDownloadButton"+this.state.viewType]}):null,this.state.viewType===Le&&this.props.allowDelete&&this.state.folders[e.id]&&this.state.folders[e.id].length&&(this.state.expertMode||e.id.startsWith(Ne)||e.id.startsWith("vis.0/"))?Object(Fe.jsx)(j.a,{"aria-label":"delete",onClick:function(t){t.stopPropagation(),s.suppressDeleteConfirm>Date.now()?s.deleteItem(e.id):s.setState({deleteItem:e.id})},className:this.props.classes["itemDeleteButton"+this.state.viewType],children:Object(Fe.jsx)(be.a,{fontSize:"small"})}):this.state.viewType===Le&&this.props.allowDelete?Object(Fe.jsx)("div",{className:this.props.classes["itemDeleteButton"+this.state.viewType]}):null]},e.id)}},{key:"renderBackFolder",value:function(){var e=this;return Object(Fe.jsxs)("div",{id:this.state.currentDir,onClick:function(t){return e.changeFolder(t)},title:this.props.t("re_Back to %s",Ee(this.state.currentDir)),className:E.a.clsx("browserItem",this.props.classes["item"+this.state.viewType],this.props.classes["itemFolder"+this.state.viewType]),children:[Object(Fe.jsx)(ke.a,{className:this.props.classes["itemFolderIcon"+this.state.viewType]}),Object(Fe.jsx)(me.a,{className:this.props.classes.itemFolderIconBack}),Object(Fe.jsx)("div",{className:E.a.clsx(this.props.classes["itemName"+this.state.viewType],this.props.classes["itemNameFolder"+this.state.viewType]),children:".."})]},this.state.currentDir)}},{key:"formatSize",value:function(e){return Object(Fe.jsx)("div",{className:this.props.classes["itemSize"+this.state.viewType],children:e||0===e?E.a.formatBytes(e):""})}},{key:"formatAcl",value:function(e){var t=this,s=e&&(e.permissions||e.file);return s&&(s=s.toString(16).padStart(3,"0")),Object(Fe.jsxs)("div",{className:this.props.classes["itemAccess"+this.state.viewType],children:[" ",Object(Fe.jsx)(j.a,{onClick:function(){return t.setState({modalEditOfAccess:!0})},className:this.props.classes["itemAclButton"+this.state.viewType],children:s||"---"})]})}},{key:"getFileIcon",value:function(e){switch(e){case"json":return Object(Fe.jsx)(V.a,{className:this.props.classes["itemIcon"+this.state.viewType]});case"css":return Object(Fe.jsx)(U.a,{className:this.props.classes["itemIcon"+this.state.viewType]});case"js":case"ts":return Object(Fe.jsx)(Q.a,{className:this.props.classes["itemIcon"+this.state.viewType]});case"html":case"md":return Object(Fe.jsx)(X.a,{className:this.props.classes["itemIcon"+this.state.viewType]});case"mp3":case"ogg":case"wav":case"m4a":case"mp4":case"flac":return Object(Fe.jsx)(ie.a,{className:this.props.classes["itemIcon"+this.state.viewType]});default:return Object(Fe.jsx)(Z.a,{className:this.props.classes["itemIcon"+this.state.viewType]})}}},{key:"getEditFile",value:function(e){switch(e){case"json":case"js":case"html":case"txt":return!0;default:return!1}}},{key:"renderFile",value:function(e){var t=this,s=this.state.viewType===Le?e.level*this.levelPadding:0,i=E.a.getFileExtension(e.name);return Object(Fe.jsxs)("div",{id:e.id,onDoubleClick:function(){t.props.onSelect?t.props.filterFiles&&!t.props.filterFiles.includes(e.ext)||t.props.filterByType&&!_.EXTENSIONS[t.props.filterByType].includes(e.ext)||t.props.onSelect(e.id,!0):t.setState({viewer:t.imagePrefix+e.id})},onClick:function(s){return t.select(e.id,s)},style:this.state.viewType===Le?{marginLeft:s,width:"calc(100% - "+s+"px)"}:{},className:E.a.clsx("browserItem",this.props.classes["item"+this.state.viewType],this.props.classes["itemFile"+this.state.viewType],this.state.selected===e.id&&this.props.classes.itemSelected),children:[_.EXTENSIONS.images.includes(i)?Object(Fe.jsx)("img",{onError:function(e){e.target.onerror=null,e.target.src=ye.default},className:E.a.clsx(this.props.classes["itemImage"+this.state.viewType],this.getClassBackgroundImage()),src:this.imagePrefix+e.id,alt:e.name}):this.getFileIcon(i),Object(Fe.jsx)("div",{className:this.props.classes["itemName"+this.state.viewType],children:e.name}),Object(Fe.jsx)(I.a,{xsDown:!0,children:this.formatSize(e.size)}),Object(Fe.jsx)(I.a,{xsDown:!0,children:this.state.viewType===Le?this.formatAcl(e.acl):null}),Object(Fe.jsx)(I.a,{xsDown:!0,children:this.state.viewType===Le&&this.props.expertMode&&this.getEditFile(i)?Object(Fe.jsx)(j.a,{"aria-label":"delete",onClick:function(s){s.stopPropagation(),t.props.onSelect?t.props.filterFiles&&!t.props.filterFiles.includes(e.ext)||t.props.filterByType&&!_.EXTENSIONS[t.props.filterByType].includes(e.ext)||t.props.onSelect(e.id,!0):t.setState({viewer:t.imagePrefix+e.id,formatEditFile:i})},className:this.props.classes["itemDeleteButton"+this.state.viewType],children:Object(Fe.jsx)(Y.a,{fontSize:"small"})}):Object(Fe.jsx)("div",{className:this.props.classes["itemDeleteButton"+this.state.viewType]})}),this.state.viewType===Le&&this.props.allowDownload?Object(Fe.jsx)(j.a,{download:!0,href:this.imagePrefix+e.id,className:this.props.classes["itemDownloadButton"+this.state.viewType],onClick:function(e){return e.stopPropagation()},children:Object(Fe.jsx)(ae.a,{})}):null,this.state.viewType===Le&&this.props.allowDelete&&"vis.0/"!==e.id&&e.id!==Ne&&(this.state.expertMode||e.id.startsWith(Ne)||e.id.startsWith("vis.0/"))?Object(Fe.jsx)(j.a,{"aria-label":"delete",onClick:function(s){s.stopPropagation(),t.suppressDeleteConfirm>Date.now()?t.deleteItem(e.id):t.setState({deleteItem:e.id})},className:this.props.classes["itemDeleteButton"+this.state.viewType],children:Object(Fe.jsx)(be.a,{fontSize:"small"})}):this.state.viewType===Le&&this.props.allowDelete?Object(Fe.jsx)("div",{className:this.props.classes["itemDeleteButton"+this.state.viewType]}):null]},e.id)}},{key:"renderItems",value:function(e){var t=this;if(e&&"/"!==e&&!this.state.expertMode&&e!==Ne&&!e.startsWith(Ne)&&"vis.0"!==e&&!e.startsWith("vis.0/"))return null;if(this.state.folders&&this.state.folders[e]){if(this.state.viewType===_e){var s=[];return e&&"/"!==e&&s.push(this.renderBackFolder()),this.state.folders[e].forEach((function(e){(t.state.expertMode||e.id===Ne||e.id.startsWith(Ne)||"vis.0"===e.id||e.id.startsWith("vis.0/"))&&(e.folder?s.push(t.renderFolder(e)):t.props.filterFiles&&!t.props.filterFiles.includes(e.ext)||t.props.filterByType&&!_.EXTENSIONS[t.props.filterByType].includes(e.ext)||s.push(t.renderFile(e)))})),s}return this.state.folders[e].map((function(e){var s=[];if(e.id&&"/"!==e.id&&!t.state.expertMode&&e.id!==Ne&&!e.id.startsWith(Ne)&&"vis.0"!==e.id&&!e.id.startsWith("vis.0/"))return null;if(e.folder){var i=t.state.expanded.includes(e.id);s.push(t.renderFolder(e,i)),t.state.folders[e.id]&&i&&s.push(t.renderItems(e.id))}else{if(t.props.filterFiles&&!t.props.filterFiles.includes(e.ext)||t.props.filterByType&&!_.EXTENSIONS[t.props.filterByType].includes(e.ext))return null;s.push(t.renderFile(e))}return s}))}return Object(Fe.jsxs)("div",{style:{position:"relative"},children:[Object(Fe.jsx)(b.a,{color:"secondary",size:24},e),Object(Fe.jsx)("div",{style:{position:"absolute",zIndex:2,top:4,width:24,textAlign:"center"},children:this.state.queueLength})]})}},{key:"renderToolbar",value:function(){var e=this;return Object(Fe.jsxs)(g.a,{variant:"dense",children:[this.props.showExpertButton?Object(Fe.jsx)(j.a,{edge:"start",title:this.props.t("ra_Toggle expert mode"),className:E.a.clsx(this.props.classes.menuButton,this.state.expertMode&&this.props.classes.menuButtonExpertActive),"aria-label":"expert mode",onClick:function(){return e.setState({expertMode:!e.state.expertMode})},children:Object(Fe.jsx)(xe.a,{})}):null,this.props.showViewTypeButton?Object(Fe.jsx)(j.a,{edge:"start",title:this.props.t("ra_Toggle view mode"),className:this.props.classes.menuButton,"aria-label":"view mode",onClick:function(){var t=e.state.viewType===Le?_e:Le;window.localStorage.setItem("files.viewType",t);var s=e.state.selected;Ae(s)&&(s=Ee(s)),e.setState({viewType:t,currentDir:s},(function(){e.state.viewType===Le&&e.scrollToSelected()}))},children:this.state.viewType!==Le?Object(Fe.jsx)(pe.a,{}):Object(Fe.jsx)(he.a,{})}):null,Object(Fe.jsx)(j.a,{edge:"start",title:this.props.t("ra_Hide empty folders"),className:this.props.classes.menuButton,color:this.state.filterEmpty?"secondary":"inherit","aria-label":"filter empty",onClick:function(){window.localStorage.setItem("file.empty",!e.state.filterEmpty),e.setState({filterEmpty:!e.state.filterEmpty})},children:Object(Fe.jsx)(ce.a,{})}),Object(Fe.jsx)(j.a,{edge:"start",title:this.props.t("ra_Reload files"),className:this.props.classes.menuButton,color:"inherit","aria-label":"reload files",onClick:function(){return e.setState({folders:{}},(function(){return e.loadFolders()}))},children:Object(Fe.jsx)(M.a,{})}),this.props.allowCreateFolder?Object(Fe.jsx)(j.a,{edge:"start",disabled:this.state.expertMode?!this.state.selected:!this.state.selected.startsWith("vis.0")&&!this.state.selected.startsWith(Ne),title:this.props.t("ra_Create folder"),className:this.props.classes.menuButton,color:"inherit","aria-label":"add folder",onClick:function(){return e.setState({addFolder:!0})},children:Object(Fe.jsx)(oe.a,{})}):null,this.props.allowUpload?Object(Fe.jsx)(j.a,{edge:"start",disabled:this.state.expertMode?!this.state.selected:!this.state.selected.startsWith("vis.0")&&!this.state.selected.startsWith(Ne),title:this.props.t("ra_Upload file"),className:this.props.classes.menuButton,color:"inherit","aria-label":"upload file",onClick:function(){return e.setState({uploadFile:!0})},children:Object(Fe.jsx)(te.a,{})}):null,Object(Fe.jsx)(D.a,{title:this.props.t("Background image"),children:Object(Fe.jsx)(j.a,{color:"inherit",edge:"start",className:this.props.classes.menuButton,onClick:this.setStateBackgroundImage,children:Object(Fe.jsx)(je.a,{})})})]},"toolbar")}},{key:"findItem",value:function(e,t){if(!(t=t||this.state.folders))return null;var s=e.split("/");s.pop();var i=s.join("/")||"/";return t[i]?t[i].find((function(t){return t.id===e})):null}},{key:"renderInputDialog",value:function(){var e=this;if(this.state.addFolder){var t=this.findFirstFolder(this.state.selected);return t?Object(Fe.jsx)(L.a,{applyText:this.props.t("ra_Create"),cancelText:this.props.t("ra_Cancel"),titleText:this.props.t("ra_Create new folder in %s",this.state.selected),promptText:this.props.t("ra_If no file will be created in the folder, it will disappear after the browser closed"),labelText:this.props.t("ra_Folder name"),verify:function(s){return e.state.folders[t].find((function(e){return e.name===s}))?"":e.props.t("ra_Duplicate name")},onClose:function(s){if(s){var i={};Object.keys(e.state.folders).forEach((function(t){return i[t]=e.state.folders[t]}));var r=e.findItem(t),a=t+"/"+s;i[t].push({id:a,level:r.level+1,name:s,folder:!0,temp:!0}),i[t].sort(Be),i[a]=[];var n=Object(h.a)(e.state.expanded);n.includes(t)||(n.push(t),n.sort()),window.localStorage.setItem("files.expanded",JSON.stringify(n)),e.setState({addFolder:!1,folders:i,expanded:n},(function(){return e.select(a)}))}else e.setState({addFolder:!1})},replace:function(e){return e.replace(/[^-_\w\d]/,"_")}},"inputDialog"):window.alert(this.props.t("ra_Invalid parent folder!"))}return null}},{key:"componentDidUpdate",value:function(e,t,s){var i=this;this.setOpacityTimer&&clearTimeout(this.setOpacityTimer),this.setOpacityTimer=setTimeout((function(){i.setOpacityTimer=null;for(var e=window.document.getElementsByClassName("browserItem"),t=0;t<e.length;t++)e[t].style.opacity=1}),100)}},{key:"uploadFile",value:function(e,t){var s=e.split("/"),i=s.shift();return this.props.socket.writeFile64(i,s.join("/"),t).catch((function(e){return window.alert("Cannot write file: "+e)}))}},{key:"findFirstFolder",value:function(e){var t=e,s=this.findItem(t);if(s&&!s.folder){var i=t.split("/");for(i.pop(),t="";i.length;){var r=this.findItem(i.join("/"));if(r&&r.folder){t=i.join("/");break}}}return t}},{key:"renderUpload",value:function(){var e=this;return this.state.uploadFile?[Object(Fe.jsx)(w.a,{color:"primary","aria-label":"close",className:this.props.classes.uploadCloseButton,onClick:function(){return e.setState({uploadFile:!1})},children:Object(Fe.jsx)(G.a,{})},"close"),Object(Fe.jsx)(v.default,{onDragEnter:function(){return e.setState({uploadFile:"dragging"})},onDragLeave:function(){return e.setState({uploadFile:!0})},onDrop:function(t){var s=t.length;t.forEach((function(t){var i=new FileReader;i.onabort=function(){return console.log("file reading was aborted")},i.onerror=function(){return console.log("file reading has failed")},i.onload=function(){var r=e.findFirstFolder(e.state.selected);if(!r)return window.alert(e.props.t("ra_Invalid parent folder!"));var a=r+"/"+t.name;e.uploadFile(a,i.result).then((function(){if(!--s){var t={};Object.keys(e.state.folders).forEach((function(s){s===r||s.startsWith(r+"/")||(t[s]=e.state.folders[s])})),e.setState({uploadFile:!1,folders:t},(function(){return e.browseFolders(Object(h.a)(e.state.expanded),t).then((function(t){var s=Object(h.a)(e.state.expanded);s.includes(r)||(s.push(r),s.sort(),window.localStorage.setItem("files.expanded",JSON.stringify(s))),e.setState({folders:t,expanded:s},(function(){return e.select(a)}))}))}))}}))},i.readAsArrayBuffer(t)}))},children:function(t){var s=t.getRootProps,i=t.getInputProps;return Object(Fe.jsxs)("div",Object(u.a)(Object(u.a)({className:E.a.clsx(e.props.classes.uploadDiv,"dragging"===e.state.uploadFile&&e.props.classes.uploadDivDragging)},s()),{},{children:[Object(Fe.jsx)("input",Object(u.a)({},i())),Object(Fe.jsx)("div",{className:e.props.classes.uploadCenterDiv,children:Object(Fe.jsxs)("div",{className:e.props.classes.uploadCenterTextAndIcon,children:[Object(Fe.jsx)(te.a,{className:e.props.classes.uploadCenterIcon}),Object(Fe.jsx)("div",{className:e.props.classes.uploadCenterText,children:"dragging"===e.state.uploadFile?e.props.t("ra_Drop file here"):e.props.t("ra_Place your files here or click here to open the browse dialog")})]})})]}))}},"dropzone")]:null}},{key:"deleteRecursive",value:function(e){var t=this,s=this.findItem(e);if(s.folder)return(this.state.folders[e]?Promise.all(this.state.folders[e].map((function(e){return t.deleteRecursive(e.id)}))):Promise.resolve()).then((function(){if(s.level>=1){var i=e.split("/"),r=i.shift();t.props.socket.deleteFolder(r,i.join("/")).then((function(){var e=JSON.parse(JSON.stringify(t.state.folders));delete e[s.id];var i=Ee(s.id),r=e[i];if(r){var a=r.indexOf(r.find((function(e){return e.id===s.id})));-1!==a&&r.splice(a,1),t.select(i,(function(){return t.setState({folders:e})}))}}))}}));var i=e.split("/"),r=i.shift();return i.length?this.props.socket.deleteFile(r,i.join("/")).catch((function(e){return window.alert("Cannot delete file: "+e)})):Promise.resolve()}},{key:"deleteItem",value:function(e){var t=this;e=e||this.state.deleteItem,this.setState({deleteItem:""},(function(){return t.deleteRecursive(e).then((function(){var s=t.state.expanded.indexOf(e);if(-1!==s){var i=Object(h.a)(t.state.expanded);i.splice(s,1),window.localStorage.setItem("files.expanded",JSON.stringify(i)),t.setState({expanded:i})}}))}))}},{key:"renderDeleteDialog",value:function(){var e=this;return!!this.state.deleteItem&&Object(Fe.jsxs)(x.a,{open:!0,onClose:function(){return e.setState({deleteItem:""})},"aria-labelledby":"form-dialog-title",children:[Object(Fe.jsx)(y.a,{id:"form-dialog-title",children:this.props.t("ra_Confirm deletion of %s",this.state.deleteItem.split("/").pop())}),Object(Fe.jsx)(O.a,{children:Object(Fe.jsx)(k.a,{children:this.props.t("ra_Are you sure?")})}),Object(Fe.jsxs)(S.a,{children:[Object(Fe.jsx)(T.a,{variant:"contained",onClick:function(){e.suppressDeleteConfirm=Date.now()+3e5,e.deleteItem()},children:this.props.t("ra_Delete (no confirm for 5 mins)")}),Object(Fe.jsx)(T.a,{variant:"contained",onClick:function(){return e.deleteItem()},color:"primary",autoFocus:!0,children:this.props.t("ra_Delete")}),Object(Fe.jsx)(T.a,{variant:"contained",onClick:function(){return e.setState({deleteItem:""})},children:this.props.t("ra_Cancel")})]})]},"deleteDialog")}},{key:"renderViewDialog",value:function(){var e=this;return this.state.viewer?Object(Fe.jsx)(P.a,{href:this.state.viewer,formatEditFile:this.state.formatEditFile,themeName:this.props.themeName,setStateBackgroundImage:this.setStateBackgroundImage,getClassBackgroundImage:this.getClassBackgroundImage,t:this.props.t,socket:this.props.socket,lang:this.props.lang,expertMode:this.state.expertMode,onClose:function(){return e.setState({viewer:"",formatEditFile:""})}},this.state.viewer):null}},{key:"renderError",value:function(){var e=this;return this.state.errorText?Object(Fe.jsx)(N.a,{text:this.state.errorText,onClose:function(){return e.setState({errorText:""})}},"errorDialog"):null}},{key:"updateItemsAcl",value:function(e){var t,s=this,i=JSON.parse(JSON.stringify(this.state.folders));e.forEach((function(e){var r=s.findItem(e.id,i);r&&JSON.stringify(r.acl)!==JSON.stringify(e.acl)&&(r.acl=e.acl,t=!0)})),t&&this.setState({folders:i})}},{key:"changeToPath",value:function(){var e=this;setTimeout((function(){if(e.state.path!==e.state.selected&&(!e.lastSelect||Date.now()-e.lastSelect>100)){var t=e.state.path;return Ae(e.state.path)&&(t=Ee(e.state.path)),new Promise((function(s){return e.state.folders[t]?s(!0):e.browseFolder(t).then((function(t){return e.setState({folders:t},(function(){return s(!0)}))})).catch((function(s){return e.setState({errorText:s===Ce?e.props.t('re_Cannot find "%s"',t):e.props.t('re_Cannot read "%s"',t)})}))})).then((function(s){return s&&e.setState({selected:e.state.path,currentDir:t,pathFocus:!1})}))}(!e.lastSelect||Date.now()-e.lastSelect>100)&&e.setState({pathFocus:!1})}),100)}},{key:"renderBreadcrumb",value:function(){var e=this,t=this.state.selected.startsWith("/")?this.state.selected.split("/"):("/"+this.state.selected).split("/"),s=[];return t.map((function(i,r){i&&s.push(i);var a=s.join("/");return r<t.length-1?[Object(Fe.jsx)("div",{className:e.props.classes.pathDivBreadcrumbDir,onClick:function(t){return e.changeFolder(t,a||"/")},children:i||e.props.t("re_Root")},e.state.selected+"_"+r),Object(Fe.jsx)("span",{className:e.props.classes.pathDivBreadcrumbSlash,children:">"},e.state.selected+"_s_"+r)]:Object(Fe.jsx)("div",{className:e.props.classes.pathDivBreadcrumbFile,onClick:function(){return e.setState({pathFocus:!0})},children:i},e.state.selected+"_"+r)}))}},{key:"renderPath",value:function(){var e=this;return Object(Fe.jsx)("div",{className:E.a.clsx(this.props.classes.pathDiv,!this.state.pathFocus&&this.props.classes.pathDivBreadcrumb),children:this.state.pathFocus?Object(Fe.jsx)(F.a,{value:this.state.path,onKeyDown:function(t){return 13===t.keyCode&&e.changeToPath()},onBlur:function(t){return e.changeToPath()},onChange:function(t){return e.setState({path:t.target.value})},className:this.props.classes.pathDivInput}):this.renderBreadcrumb()},"path")}},{key:"render",value:function(){var e=this;return this.props.ready?(this.state.loadAllFolders&&!this.foldersLoading&&(this.foldersLoading=!0,setTimeout((function(){e.setState({loadAllFolders:!1,folders:{}},(function(){e.foldersLoading=!1,e.loadFolders()}))}),300)),Object(Fe.jsxs)("div",{style:this.props.style,className:E.a.clsx(this.props.classes.root,this.props.className),children:[this.props.showToolbar?this.renderToolbar():null,this.state.viewType===_e?this.renderPath():null,Object(Fe.jsx)("div",{className:E.a.clsx(this.props.classes.filesDiv,this.props.classes["filesDiv"+this.state.viewType]),children:this.state.viewType===Le?this.renderItems("/"):this.renderItems(this.state.currentDir||"/")},"items"),this.props.allowUpload?this.renderInputDialog():null,this.props.allowUpload?this.renderUpload():null,this.props.allowDelete?this.renderDeleteDialog():null,this.props.allowView?this.renderViewDialog():null,this.state.modalEditOfAccess&&this.props.modalEditOfAccessControl&&this.props.modalEditOfAccessControl(this,this.state.modalEditOfAccessObjData),this.renderError()]},this.props.key)):Object(Fe.jsx)(p.a,{},this.props.key?this.props.key+"_c":"c")}}],[{key:"getDerivedStateFromProps",value:function(e,t){return void 0!==e.expertMode&&e.expertMode!==t.expertMode?{expertMode:e.expertMode,loadAllFolders:!t.allFoldersLoaded&&e.expertMode}:null}}]),s}(d.Component);Pe.defaultProps={objectAddBoolean:!1,objectEditBoolean:!1,objectStatesView:!1,objectImportExport:!1,objectEditOfAccessControl:!1,modalNewObject:function(){},modalEditOfAccessControl:function(){}};var ze=Object(f.a)()(Object(m.a)((function(e){return{dialog:{height:"calc(100% - ".concat(e.mixins.toolbar.minHeight,"px)")},root:{width:"100%",overflow:"hidden",height:"100%",position:"relative"},filesDiv:{width:"calc(100% - ".concat(e.spacing(2),"px)"),overflowX:"hidden",overflowY:"auto",padding:e.spacing(1)},filesDivTable:{height:"calc(100% - ".concat(48+e.spacing(1),"px)")},filesDivTile:{height:"calc(100% - ".concat(96+e.spacing(1),"px)"),display:"flex",alignContent:"flex-start",alignItems:"stretch",flexWrap:"wrap",flex:"0 0 ".concat(64,"px")},itemTile:{position:"relative",userSelect:"none",cursor:"pointer",height:De,width:64,display:"inline-block",textAlign:"center",opacity:.1,transition:"opacity 1s",margin:4,"&:hover":{background:e.palette.secondary.light,color:E.a.invertColor(e.palette.secondary.main,!0)}},itemNameFolderTile:{fontWeight:"bold"},itemNameTile:{width:"100%",height:32,overflow:"hidden",textOverflow:"ellipsis",fontSize:12,textAlign:"center",wordBreak:"break-all"},itemFolderIconTile:{width:"100%",height:64,display:"block",paddingLeft:8,color:e.palette.secondary.main||"#fbff7d"},itemFolderIconBack:{position:"absolute",top:22,left:18,zIndex:1,color:"dark"===e.palette.type?"#FFF":"#000"},itemSizeTile:{width:"100%",height:16,textAlign:"center",fontSize:10},itemImageTile:{width:"calc(100% - 8px)",height:64,margin:4,display:"block",textAlign:"center",objectFit:"contain"},itemIconTile:{width:"100%",height:64,display:"block",objectFit:"contain"},itemSelected:{background:e.palette.primary.main,color:E.a.invertColor(e.palette.primary.main,!0)},itemTable:{userSelect:"none",cursor:"pointer",height:32,display:"inline-flex",lineHeight:"32px","&:hover":{background:e.palette.secondary.light,color:E.a.invertColor(e.palette.secondary.main,!0)}},itemNameTable:{display:"inline-block",paddingLeft:10,fontSize:"1rem",verticalAlign:"top",flexGrow:1},itemNameFolderTable:{fontWeight:"bold"},itemSizeTable:{display:"inline-block",width:60,verticalAlign:"top",textAlign:"right"},itemAccessTable:{verticalAlign:"top",width:60,textAlign:"right",paddingRight:5,display:"flex",justifyContent:"center"},itemImageTable:{display:"inline-block",width:30,marginTop:1,objectFit:"contain",maxHeight:30},itemIconTable:{display:"inline-block",marginTop:1,width:30,height:30},itemFolderTable:{},itemFolderTemp:{opacity:.4},itemFolderIconTable:{marginTop:1,marginLeft:e.spacing(1),display:"inline-block",width:30,height:30,color:e.palette.secondary.main||"#fbff7d"},itemDownloadButtonTable:{display:"inline-block",width:Ie,height:32,minWidth:Ie,verticalAlign:"top",padding:0,"& span":{paddingTop:9},"& svg":{width:14,height:14,fontSize:"1rem"}},itemAclButtonTable:{width:Ie,height:32,minWidth:Ie,verticalAlign:"top",padding:0,fontSize:12,display:"flex"},itemDeleteButtonTable:{display:"inline-block",width:Ie,height:32,minWidth:Ie,verticalAlign:"top",padding:0,"& svg":{width:18,height:18,fontSize:"1.5rem"}},uploadDiv:{top:0,zIndex:1,bottom:0,left:0,right:0,position:"absolute",opacity:.9,textAlign:"center",background:"#FFFFFF"},uploadDivDragging:{opacity:1},uploadCenterDiv:{margin:20,border:"3px dashed grey",borderRadius:30,width:"calc(100% - 40px)",height:"calc(100% - 40px)",position:"relative",color:"dark"===e.palette.type?"#222":"#CCC"},uploadCenterIcon:{width:"25%",height:"25%"},uploadCenterText:{fontSize:24,fontWeight:"bold"},uploadCloseButton:{zIndex:2,position:"absolute",top:30,right:30},uploadCenterTextAndIcon:{position:"absolute",top:"50%",left:"50%",height:"30%",width:"50%",margin:"-15% 0 0 -25%"},menuButtonExpertActive:{color:"#c00000"},pathDiv:{display:"flex",width:"calc(100% - ".concat(e.spacing(2),"px)"),marginLeft:e.spacing(1),marginRight:e.spacing(1),textOverflow:"clip",overflow:"hidden",whiteSpace:"nowrap"},pathDivInput:{width:"100%"},pathDivBreadcrumb:{paddingTop:3,paddingBottom:2,borderBottom:"solid 1px"},pathDivBreadcrumbDir:{paddingLeft:4,paddingRight:4,paddingBottom:4,cursor:"pointer","&:hover":{background:"dark"===e.palette.type?"#333":"#CCC"}},pathDivBreadcrumbSlash:{paddingLeft:4,paddingRight:4,paddingBottom:4,opacity:.7},pathDivBreadcrumbFile:{cursor:"pointer",flexGrow:1},backgroundImageLight:{background:"white"},backgroundImageDark:{background:"black"},backgroundImageColored:{background:"silver"},"@media screen and (max-width: 500px)":{itemNameTable:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",textAlign:"end",direction:"rtl"}}}}))(Pe)),Me=s(427),We=s(521),Ge=s(26),Re=s(677),Ve=s(493),Je=s(9),Ue=s.n(Je),qe=s(82),Xe=s(342),He=s(537),Ye=s.n(He),Ke=[{Owner:[{name:"read",valueNum:1024,title:"read owner"},{name:"write",valueNum:512,title:"write owner"}]},{Group:[{name:"read",valueNum:64,title:"read group"},{name:"write",valueNum:32,title:"write group"}]},{Everyone:[{name:"read",valueNum:4,title:"read everyone"},{name:"write",valueNum:2,title:"write everyone"}]}],Qe=function(e,t,s){return e|=t&s,e&=t|65535&~s},$e=function(e){var t=e.value,s=e.setValue,i=e.t,r=e.differentValues,a=e.applyToChildren,n=e.mask,o=e.setMask,l=e.disabled;Object(d.useEffect)((function(){if(a){for(var e=0,s=0;s<r.length;s++)e|=t^r[s];o(e)}else o(0)}),[r,a]);var c=t;return Object(Fe.jsx)("div",{style:{display:"flex",width:"fit-content",margin:20,border:"1px solid",borderLeft:0},children:Ke.map((function(e){var r=Object.keys(e)[0];return Object(Fe.jsxs)("div",{style:{width:150,height:150,display:"flex",flexDirection:"column",alignItems:"center",borderLeft:"1px solid"},children:[Object(Fe.jsx)("div",{style:{height:50,display:"flex",alignItems:"center",fontSize:18,borderBottom:"1px solid silver",width:"100%",justifyContent:"center"},children:i(r)}),Object(Fe.jsx)("div",{style:{display:"flex",width:"100%"},children:e[r].map((function(e,r){var a=!1;return c-e.valueNum>=0&&(c-=e.valueNum,a=!0),Object(Fe.jsxs)("div",{style:{display:"flex",flexDirection:"column",flex:1,alignItems:"center",borderRight:0===r?"1px solid":0},children:[Object(Fe.jsx)("div",{style:{height:50,borderBottom:"1px solid",width:"100%",justifyContent:"center",display:"flex",alignItems:"center",color:"silver"},children:i(e.name)}),Object(Fe.jsx)("div",{style:{height:50,display:"flex"},children:Object(Fe.jsx)(Re.a,{disabled:l,checked:a,color:n&e.valueNum?"primary":"secondary",indeterminate:!!(n&e.valueNum),style:n&e.valueNum?{opacity:.5}:null,onChange:function(i){n&e.valueNum&&(n&=65535&~e.valueNum,o(n));var r=t;i.target.checked?r|=e.valueNum:r&=65535&~e.valueNum,s(r)}})})]},e.valueNum)}))})]},r)}))})};function Ze(e,t,s){return et.apply(this,arguments)}function et(){return(et=Object(a.a)(r.a.mark((function e(t,s,i){var a,n,o,l,c,d,p,u,h,f;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=s[t]){e.next=11;break}return n=t.split("/"),o=n.length,l=n.shift(),c=n.join("/"),e.next=8,i.readDir(l,c);case 8:for(a=e.sent,s[t]=[],d=0;d<a.length;d++)p=a[d],u={id:t+"/"+p.file,ext:qe.a.getFileExtension(p.file),folder:p.isDir,name:p.file,size:p.stats&&p.stats.size,modified:p.modifiedAt,acl:p.acl,level:o},s[t].push(u);case 11:h=0;case 12:if(!(h<a.length)){e.next=20;break}if(!(f=a[h]).folder){e.next=17;break}return e.next=17,Ze(f.id,s,i);case 17:h++,e.next=12;break;case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tt(e){var t={};return Object.keys(e).forEach((function(s){t[s]={folder:!0},e[s].forEach((function(e){t[e.id]=e}))})),t}function st(e,t,s,i,r,a){return it.apply(this,arguments)}function it(){return(it=Object(a.a)(r.a.mark((function e(t,s,i,a,n,o){var l,c,d;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"===typeof i&&(i=i.split("/"),o=0,a=i.shift(),n=""),!(i.length>=o)){e.next=3;break}return e.abrupt("return");case 3:if(!s[a+n]){e.next=16;break}if(i.length-1!==o){e.next=11;break}if(l=a+n+"/"+i[o],!(c=s[a+n].find((function(e){return e.id===l})))||!c.folder){e.next=10;break}return e.next=10,Ze(a+n,s,t);case 10:return e.abrupt("return");case 11:return n+="/"+i[o],e.next=14,st(t,s,i,a,n,o+1);case 14:e.next=23;break;case 16:return e.next=18,t.readDir(a,n);case 18:return d=e.sent,s[a+n]=[],d.forEach((function(e){var t={id:n+"/"+e.file,ext:qe.a.getFileExtension(e.file),folder:e.isDir,name:e.file,size:e.stats&&e.stats.size,modified:e.modifiedAt,acl:e.acl,level:o};s[a+n].push(t)})),e.next=23,st(t,s,i,a,n,o+1);case 23:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var rt="different",at=function(e){var t=e.onClose,s=e.onApply,i=e.open,n=e.selected,o=e.extendObject,l=e.objects,c=e.t,u=e.themeType,h=e.folders,f=e.socket,m=n.substring(0,n.lastIndexOf("/"))||n,v=1===n.split("/").length?h["/"].find((function(e){return e.id===n})):h[m].find((function(e){return e.id===n})),b=Object(d.useState)(null),g=Object(Ge.a)(b,2),j=g[0],w=g[1],x=Object(d.useState)(null),y=Object(Ge.a)(x,2),O=y[0],k=y[1],S=Object(d.useState)([]),T=Object(Ge.a)(S,2),F=T[0],I=T[1],D=Object(d.useState)([]),C=Object(Ge.a)(D,2),N=C[0],B=C[1],E=Object(d.useState)(!1),A=Object(Ge.a)(E,2),L=A[0],_=A[1],P=Object(d.useState)(0),z=Object(Ge.a)(P,2),M=z[0],W=z[1],G=Object(d.useState)(null),R=Object(Ge.a)(G,2),V=R[0],J=R[1],U=Object(d.useState)(!1),q=Object(Ge.a)(U,2),X=q[0],H=q[1],Y=Object(d.useState)(!1),K=Object(Ge.a)(Y,2),Q=K[0],$=K[1],Z=Object(d.useState)([]),ee=Object(Ge.a)(Z,2),te=ee[0],se=ee[1],ie=Object(d.useState)(0),re=Object(Ge.a)(ie,2),ae=re[0],ne=re[1],oe=Object(d.useState)([]),le=Object(Ge.a)(oe,2),ce=le[0],de=le[1],pe=Object(d.useState)(!0),ue=Object(Ge.a)(pe,2),he=ue[0],fe=ue[1],me=Object(d.useState)(!1),ve=Object(Ge.a)(me,2),be=ve[0],ge=ve[1],je=Ue.a.getLanguage();return Object(d.useEffect)(Object(a.a)(r.a.mark((function e(){var t,s,i,a,n,o,c,d,p,u,m,b,g,j;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],s=v.id,i=!1,a=!1,n=null,o=null,c=null,d=[],p=0,e.next=11,st(f,h,s);case 11:u=tt(h),m=s+"/",Object.keys(u).forEach((function(e){if("/"!==e&&(e===s||e.startsWith(m)))if(!e.includes("/")&&l[e]){var r=l[e];p++,d.push(r),null===c&&void 0!==r.acl.file&&(c=r.acl.file),null===n&&void 0!==r.acl.owner&&(n=r.acl.owner),null===o&&void 0!==r.acl.ownerGroup&&(o=r.acl.ownerGroup),X||n===r.acl.owner||void 0===r.acl.owner||(i=!0),Q||o===r.acl.ownerGroup||void 0===r.acl.ownerGroup||(a=!0),void 0===r.acl.file||c===r.acl.file||t.includes(r.acl.file)||t.push(r.acl.file)}else if(!u[e].folder){p++;var h=u[e];d.push(h),null===c&&void 0!==h.acl.permissions&&(c=h.acl.permissions),null===n&&void 0!==h.acl.owner&&(n=h.acl.owner),null===o&&void 0!==h.acl.ownerGroup&&(o=h.acl.ownerGroup),X||n===h.acl.owner||void 0===h.acl.owner||(i=!0),Q||o===h.acl.ownerGroup||void 0===h.acl.ownerGroup||(a=!0),void 0===h.acl.permissions||c===h.acl.permissions||t.includes(h.acl.permissions)||t.push(h.acl.permissions)}})),b=[],g=[],Object.keys(l).forEach((function(e){var t=l[e];e.startsWith("system.group.")&&"group"===(null===t||void 0===t?void 0:t.type)?g.push(t):e.startsWith("system.user.")&&"user"===(null===t||void 0===t?void 0:t.type)&&b.push(t)})),j=l["system.config"].common.defaultNewAcl,n=n||j.owner,o=o||j.ownerGroup,c=c||j.file,J(c),w(n),k(o),H(i),$(a),I(b),B(g),v.folder&&_(!0),W(p),se(t),de(d);case 32:case"end":return e.stop()}}),e)}))),[l,n]),Object(d.useEffect)((function(){L?(X&&j!==rt&&w(rt),Q&&O!==rt&&k(rt)):(j&&j===rt&&w(l[n].acl.owner),O&&O===rt&&k(l[n].acl.ownerGroup)),console.log("stateOwnerUser "+j)}),[L,j,O,X,Q]),ce.length?Object(Fe.jsx)(Xe.a,{open:i,titleButtonApply:"apply",overflowHidden:!0,applyDisabled:he,progress:be,onClose:t,onApply:function(){ge(!0),setTimeout(Object(a.a)(r.a.mark((function e(){var t,i,a,n,c,d,p,u,h,f,m,b,g,w,x,y,k,S,T,F,I,D,C,N,B,E,A,_,P,z,M,W,G;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=(null===(t=l["system.config"].common)||void 0===t||null===(i=t.defaultNewAcl)||void 0===i?void 0:i.file)||1636,L){e.next=28;break}if(n=v.id.split("/"),c=n.shift(),d=n.join("/"),p={},u=!1,v.folder){e.next=17;break}if((null===(h=v.acl)||void 0===h?void 0:h.permissions)!==V&&(p.permissions=V,u=!0),(null===(f=v.acl)||void 0===f?void 0:f.owner)!==j&&(p.owner=j,u=!0),(null===(m=v.acl)||void 0===m?void 0:m.ownerGroup)!==O&&(p.ownerGroup=O,u=!0),e.t0=u,!e.t0){e.next=15;break}return e.next=15,o(c,d,p);case 15:e.next=26;break;case 17:if(n.length||!l[v.id]){e.next=26;break}if(x=l[v.id],(null===(b=x.acl)||void 0===b?void 0:b.file)!==V&&(x.acl=x.acl||{},x.acl.file=V,u=!0),(null===(g=x.acl)||void 0===g?void 0:g.owner)!==j&&(x.acl=x.acl||{},x.acl.owner=j,u=!0),(null===(w=x.acl)||void 0===w?void 0:w.ownerGroup)!==O&&(x.acl=x.acl||{},x.acl.ownerGroup=O,u=!0),e.t1=u,!e.t1){e.next=26;break}return e.next=26,o(x._id,x);case 26:e.next=61;break;case 28:y=65535&~ae,k=0;case 30:if(!(k<ce.length)){e.next=61;break}if(S=ce[k],T=!1,!S._id){e.next=44;break}if((N=Qe((null===(F=S.acl)||void 0===F?void 0:F.file)||a,V,y))!==(null===(I=S.acl)||void 0===I?void 0:I.file)&&(S.acl=S.acl||{},S.acl.file=N,T=!0),j!==rt&&j!==(null===(D=S.acl)||void 0===D?void 0:D.owner)&&(S.acl=S.acl||{},S.acl.owner=j,T=!0),O!==rt&&O!==(null===(C=S.acl)||void 0===C?void 0:C.ownerGroup)&&(S.acl=S.acl||{},S.acl.ownerGroup=O,T=!0),e.t2=T,!e.t2){e.next=42;break}return e.next=42,o(S._id,S);case 42:e.next=58;break;case 44:if(!S||S.folder){e.next=58;break}if(P={},(z=Qe((null===(B=S.acl)||void 0===B?void 0:B.permissions)||a,V,y))!==(null===(E=S.acl)||void 0===E?void 0:E.permissions)&&(P.permissions=z,T=!0),j!==rt&&j!==(null===(A=S.acl)||void 0===A?void 0:A.owner)&&(P.owner=j,T=!0),O.value!==rt&&O!==(null===(_=S.acl)||void 0===_?void 0:_.ownerGroup)&&(P.ownerGroup=O,T=!0),!T){e.next=58;break}if(M=S.id.split("/"),W=M.shift(),G=M.join("/"),e.t3=T,!e.t3){e.next=58;break}return e.next=58,o(W,G,P);case 58:k++,e.next=30;break;case 61:ge(!1),s();case 63:case"end":return e.stop()}}),e)}))),200)},children:Object(Fe.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[Object(Fe.jsx)("div",{style:{margin:10,fontSize:20},children:c("Access control list: %s",n)}),Object(Fe.jsxs)("div",{style:{display:"flex"},children:[Object(Fe.jsx)(Ye.a,{fullWidth:!0,style:{marginRight:10},label:c("Owner user"),lang:je,list:F,t:c,disabled:be,value:j,themeType:u,different:!!X&&rt,onChange:function(e){H(!1),w(e),fe(!1)}}),Object(Fe.jsx)(Ye.a,{fullWidth:!0,label:c("Owner group"),lang:je,list:N,t:c,disabled:be,value:O,themeType:u,different:!!Q&&rt,onChange:function(e){$(!1),k(e),fe(!1)}})]}),Object(Fe.jsxs)("div",{style:{display:"flex",margin:10,alignItems:"center",fontSize:10,marginLeft:0,color:"silver"},children:[Object(Fe.jsx)("div",{style:v.folder&&L?null:{color:"green"},children:c("to apply one item")}),Object(Fe.jsx)(Ve.a,{disabled:1===ce.length||be,checked:!l[v.id]&&!!v.folder||L,onChange:function(e){_(e.target.checked),fe(!1)},color:"primary"}),Object(Fe.jsxs)("div",{style:v.folder||L?{color:"green"}:null,children:[c("to apply with children")," ",v.folder||M>1?"(".concat(M," ").concat(c("object(s)"),")"):""]})]}),be&&Object(Fe.jsx)(p.a,{}),Object(Fe.jsx)("div",{style:{overflowY:"auto"},children:Object(Fe.jsxs)("div",{children:[Object(Fe.jsx)("h2",{children:c("File rights")}),Object(Fe.jsx)($e,{disabled:be,mask:ae,setMask:ne,applyToChildren:L,differentValues:te,t:c,setValue:function(e){J(e),fe(!1)},value:V})]})})]})}):Object(Fe.jsx)(p.a,{})},nt=function(e){Object(l.a)(s,e);var t=Object(c.a)(s);function s(e){var i;return Object(n.a)(this,s),(i=t.call(this,e)).translate=function(e,t,s){return void 0!==t?i.props.t(e,t,s):(i.wordCache[e]||(i.wordCache[e]=i.props.t(e)),i.wordCache[e])},i.t=i.translate,i.wordCache={},i.objects={},i}return Object(o.a)(s,[{key:"componentDidMount",value:function(){var e=this;this.props.socket.getObjects(!0,!0).then((function(t){return e.objects=t}))}},{key:"render",value:function(){var e=this;return this.props.ready?Object(Fe.jsx)(Me.a,{children:Object(Fe.jsx)(We.a,{overflow:"auto",children:Object(Fe.jsx)(ze,{showViewTypeButton:!0,ready:this.props.ready,socket:this.props.socket,themeName:this.props.themeName,lang:this.props.lang,t:this.props.t,showToolbar:!0,allowUpload:!0,allowView:!0,allowDownload:!0,allowCreateFolder:!0,allowDelete:!0,expertMode:this.props.expertMode,modalEditOfAccessControl:function(t,s){return Object(Fe.jsx)(at,{open:t.state.modalEditOfAccess,themeType:e.props.themeType,extendObject:function(){var s=Object(a.a)(r.a.mark((function s(i,a,n){var o,l,c,d;return r.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(a&&"object"===typeof a?(l=a,o=e.props.socket.getObject(l._id).then((function(t){return t.acl=l.acl,e.props.socket.setObject(t._id,t).then((function(){return t}))}))):a&&((n.owner||n.ownerGroup)&&n.permissions?o=e.props.socket.chownFile(i,a,{owner:n.owner,ownerGroup:n.ownerGroup}).then((function(){return e.props.socket.chmodFile(i,a,{mode:n.permissions})})):n.permissions?o=e.props.socket.chmodFile(i,a,{mode:n.permissions}):(n.owner||n.ownerGroup)&&(o=e.props.socket.chownFile(i,a,{owner:n.owner,ownerGroup:n.ownerGroup}))),!o){s.next=19;break}return s.next=4,o;case 4:if(!(c=s.sent).entries){s.next=16;break}if(!(null===c||void 0===c?void 0:c.entries)){s.next=14;break}d=0;case 8:if(!(d<(null===c||void 0===c?void 0:c.entries.length))){s.next=14;break}return s.next=11,t.updateItemsAcl([{id:i+"/"+(c.entries[d].path?c.entries[d].path+"/":"")+c.entries[d].file,acl:c.entries[d].acl}]);case 11:d++,s.next=8;break;case 14:s.next=19;break;case 16:if(!c){s.next=19;break}return s.next=19,t.updateItemsAcl([{id:c._id,acl:c.acl}]);case 19:case"end":return s.stop()}}),s)})));return function(e,t,i){return s.apply(this,arguments)}}(),selected:t.state.selected,folders:t.state.folders,objects:e.objects,socket:e.props.socket,t:e.t,onClose:function(){return t.setState({modalEditOfAccess:!1,modalEditOfAccessObjData:null})},onApply:function(){return t.setState({modalEditOfAccess:!1,modalEditOfAccessObjData:null})}})}})})}):Object(Fe.jsx)(p.a,{})}}]),s}(d.Component);t.default=nt}}]);
//# sourceMappingURL=14.f5e1a630.chunk.js.map