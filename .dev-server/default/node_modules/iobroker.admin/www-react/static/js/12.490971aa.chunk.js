(this["webpackJsonpsrc-rx"]=this["webpackJsonpsrc-rx"]||[]).push([[12],{1564:function(e,t,s){"use strict";var o=s(19),a=s(25);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(s(0)),i=(0,o(s(27)).default)(r.createElement("path",{d:"M6 19h4V5H6v14zm8-14v14h4V5h-4z"}),"Pause");t.default=i},1584:function(e,t,s){"use strict";var o=s(19),a=s(25);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(s(0)),i=(0,o(s(27)).default)(r.createElement("path",{d:"M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2z"}),"SaveAlt");t.default=i},1838:function(e,t,s){"use strict";var o=s(19),a=s(25);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(s(0)),i=(0,o(s(27)).default)(r.createElement("path",{d:"M11 15h2v2h-2zm0-8h2v6h-2zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}),"ErrorOutline");t.default=i},2008:function(e,t,s){"use strict";s.r(t);var o=s(81),a=s(11),r=s(12),i=s(14),n=s(15),l=s(0),c=s(6),d=s(320),u=s(8),h=s(113),g=s(181),p=s(1469),f=s(1471),j=s(1467),m=s(1478),b=s(1470),v=s(1468),O=s(279),w=s(80),x=s(424),y=s(331),S=s(226),k=s(227),L=s(228),C=s(277),N=s(611),D=s(747),z=s(497),E=s(496),W=s(502),I=s(278),R=s(48),H=s.n(R),M=s(185),F=s.n(M),P=s(381),_=s.n(P),T=s(1564),B=s.n(T),J=s(207),A=s.n(J),V=s(1584),Y=s.n(V),$=s(1838),G=s.n($),U=s(160),q=s.n(U),K=s(53),Q=s.n(K),X=s(187),Z=s(548),ee=s.n(Z),te=s(750),se=s.n(te),oe=s(432),ae=s.n(oe),re=s(78),ie=s.n(re),ne=s(82),le=s(427),ce=s(521),de=s(530),ue=s(3),he=["#ffadad30","#ffd6a530","#fdffb630","#caffbf30","#9bf6ff30","#a0c4ff30","#bdb2ff30","#ffc6ff30","#fffffc30"],ge=["rgba(255,109,109,0.2)","rgba(253,173,84,0.2)","rgba(241,255,88,0.2)","rgba(115,253,81,0.2)","rgba(71,235,255,0.2)","rgba(74,145,255,0.2)","rgba(108,85,255,0.2)","rgba(250,77,250,0.2)","rgba(255,255,105,0.2)"];function pe(e){var t=e.toString();return t.length<2&&(t="0"+t),t}function fe(e){var t=e.toString();return t.length<2?t="00"+t:t.length<3&&(t="0"+t),t}var je=function(e){Object(i.a)(s,e);var t=Object(n.a)(s);function s(e){var o;return Object(a.a)(this,s),(o=t.call(this,e)).logHandler=function(e,t){if(o.ignoreNextLogs)o.ignoreNextLogs=!1;else{var s=(o.state.logs||[]).concat(e);s.length>3e3&&s.splice(0,s.length-3e3);var a,r=0,i=0,n=!1,l=Object.keys(o.state.sources),c="dark"===o.props.themeType?ge:he;s.forEach((function(e){if(void 0!==e.odd?n=e.odd:(n=!n,e.odd=n),!e.time){var t=new Date(e.ts);e.time="".concat(t.getFullYear(),"-").concat(pe(t.getMonth()+1),"-").concat(pe(t.getDate())," ")+"".concat(pe(t.getHours()),":").concat(pe(t.getMinutes()),":").concat(pe(t.getSeconds()),".").concat(fe(t.getMilliseconds()))}if("error"===e.severity?i++:"warn"===e.severity&&r++,void 0===e.icon){var s,d=e.from.replace(/\.\d+$/,""),u=null===(s=o.state.adapters[d])||void 0===s?void 0:s.icon;if(u)u.startsWith("data:image")||(u="./files/".concat(d,".admin/").concat(u));else if(o.state.hosts){var h,g;u=null===(h=o.state.hosts["system."+e.from])||void 0===h||null===(g=h.common)||void 0===g?void 0:g.icon}e.icon=u||null}o.state.sources[e.from]?(a=a||JSON.parse(JSON.stringify(o.state.sources)))[e.from].active=!0:((a=a||JSON.parse(JSON.stringify(o.state.sources)))[e.from]={active:!0,color:c[l%c.length],icon:e.icon},l++)}));var d={logs:s,logSize:o.state.logSize+t,estimatedSize:!0,logWarnings:r,logErrors:i};a&&(d.sources=a),o.setState(d)}},o.state={source:window.localStorage.getItem("Log.source")||"1",severity:window.localStorage.getItem("Log.severity")||"debug",message:window.localStorage.getItem("Log.message")||"",logDeleteDialog:!1,logDownloadDialog:null,logFiles:[],logs:null,logSize:null,logErrors:0,logWarnings:0,estimatedSize:!0,pause:0,pauseCount:0,pid:JSON.parse(window.localStorage.getItem("Logs.pid"))||!1,colors:"true"===window.localStorage.getItem("Logs.colors"),adapters:{},sources:{},currentHost:o.props.currentHost,hosts:null},o.severities={silly:0,debug:1,info:2,warn:3,error:4},o.t=e.t,o.words={},o}return Object(r.a)(s,[{key:"readLogs",value:function(e,t,s){var a=this;this.props.logsWorker&&this.state.hosts?this.props.logsWorker.getLogs(e).then((function(e){if(e){var r=Object(o.a)(e.logs),i=e.logSize,n=0,l=0,c=!0,d=JSON.parse(JSON.stringify(a.state.sources));Object.values(d).forEach((function(e){return e.active=!1})),r.forEach((function(e){var t;if(c=!c,e.odd=c,!e.time){var s=new Date(e.ts);e.time="".concat(s.getFullYear(),"-").concat(pe(s.getMonth()+1),"-").concat(pe(s.getDate())," ")+"".concat(pe(s.getHours()),":").concat(pe(s.getMinutes()),":").concat(pe(s.getSeconds()),".").concat(fe(s.getMilliseconds()))}"error"===e.severity?l++:"warn"===e.severity&&n++;var o,r,i=e.from.replace(/\.\d+$/,""),u=null===(t=a.state.adapters[i])||void 0===t?void 0:t.icon;u?u.startsWith("data:image")||(u="./files/".concat(i,".admin/").concat(u)):u=null===(o=a.state.hosts["system."+e.from])||void 0===o||null===(r=o.common)||void 0===r?void 0:r.icon;e.icon=u||null,d[e.from]?d[e.from].active=!0:d[e.from]={active:!0,icon:e.icon}}));var u=0,h="dark"===a.props.themeType?ge:he;Object.keys(d).sort().forEach((function(e,t){d[e].color=h[u%h.length],u++})),t?a.setState({logFiles:t,logs:r,logSize:i,estimatedSize:!1,logErrors:l,logWarnings:n,sources:d},(function(){return s&&s()})):a.setState({logs:r,logSize:i,estimatedSize:!1,logErrors:l,logWarnings:n,sources:d},(function(){return s&&s()}))}})):t&&this.setState({logFiles:t},(function(){return s&&s()}))}},{key:"readLogFiles",value:function(){return this.props.socket.getLogsFiles(this.state.currentHost).then((function(e){if(e&&e.length){var t=[];return e.reverse(),e.forEach((function(e){var s=e.fileName.split("/").pop().replace(/iobroker\.?/,"").replace(".log","");s[0]<="9"&&t.push({path:e,name:s})})),e.sort(),e.forEach((function(e){var s=e.fileName.split("/").pop().replace(/iobroker\.?/,"").replace(".log","");s[0]>"9"&&t.push({path:e,name:s})})),t}return[]}))}},{key:"componentDidMount",value:function(){var e=this;this.props.logsWorker&&this.props.logsWorker.enableCountErrors(!1),this.props.logsWorker.registerHandler(this.logHandler),this.props.clearErrors(),this.props.socket.getCompactAdapters().then((function(t){return e.props.socket.getCompactHosts().then((function(s){return new Promise((function(o){var a={};s.forEach((function(e){return a[e._id]=e})),e.setState({adapters:t,hosts:a},(function(){return o()}))}))})).then((function(){return e.readLogFiles()})).then((function(t){return e.readLogs(!0,t)}))}))}},{key:"componentWillUnmount",value:function(){this.props.logsWorker&&this.props.logsWorker.enableCountErrors(!0),this.props.logsWorker.unregisterHandler(this.logHandler),this.props.clearErrors()}},{key:"clearLog",value:function(){this.props.logsWorker&&this.props.logsWorker.clearLines(),this.props.clearErrors(),this.setState({logs:[],logSize:null,logErrors:0,logWarnings:0})}},{key:"handleMessageChange",value:function(e){window.localStorage.setItem("Log.message",e.target.value),this.setState({message:e.target.value})}},{key:"handleSourceChange",value:function(e){window.localStorage.setItem("Log.source",e.target.value),this.setState({source:e.target.value})}},{key:"handleSeverityChange",value:function(e){window.localStorage.setItem("Log.severity",e.target.value),this.setState({severity:e.target.value})}},{key:"openLogDownload",value:function(e){this.setState({logDownloadDialog:e.currentTarget})}},{key:"closeLogDownload",value:function(){this.setState({logDownloadDialog:null})}},{key:"openLogDelete",value:function(){this.setState({logDeleteDialog:!0})}},{key:"closeLogDelete",value:function(){this.setState({logDeleteDialog:!1})}},{key:"handleLogDelete",value:function(){var e=this;this.props.socket.delLogs(this.state.currentHost).then((function(){return e.clearLog()})).then((function(){return e.readLogs(!0,null,(function(){return e.closeLogDelete()}))})).catch((function(t){e.closeLogDelete(),window.alert(t)}))}},{key:"handleLogPause",value:function(){this.setState({pause:this.state.pause?0:this.state.logs.length})}},{key:"openTab",value:function(e){window.open(e,"_blank").focus()}},{key:"getLogFiles",value:function(){var e=this,t=this.props.classes;return this.state.logFiles.map((function(s){return Object(ue.jsxs)(y.a,{className:t.downloadEntry,onClick:function(){e.openTab(s.path.fileName),e.closeLogDownload()},children:[s.name,Object(ue.jsx)(w.a,{className:t.downloadLogSize,variant:"caption",children:ne.a.formatBytes(s.path.size)||"-"})]},s.name)}))}},{key:"getSeverities",value:function(){var e=[];for(var t in this.severities)e.push(Object(ue.jsx)(y.a,{value:t,children:t},t));return e}},{key:"getSources",value:function(){var e=this,t=Object.keys(this.state.sources).sort();return t.unshift("1"),t.map((function(t){return Object(ue.jsxs)(y.a,{value:t,style:{backgroundColor:"1"===t?void 0:e.state.sources[t].color},children:["1"===t?null:Object(ue.jsx)(ie.a,{src:e.state.sources[t].icon,className:e.props.classes.iconSelect}),"1"===t?e.t("Source"):t]},t)}))}},{key:"getRows",value:function(){var e=this,t=[],s=this.props.classes,o=this.state.message.toLowerCase(),a=this.state.source,r=Object.keys(this.state.sources).sort();r.unshift("1"),r.includes(a)||(a="1");for(var i=0,n=this.state.pause>0?this.state.pause-1:this.state.logs.length-1;n>=0;n--){var l,d=this.state.logs[n];if(d){var u=d.severity,h=d.message||"",g="";if("object"!==typeof h){var p=new RegExp(d.from.replace(".","\\.").replace(")","\\)").replace("(","\\(")+" \\(\\d+\\) ","g"),f=h.match(p);f?(h=h.replace(f[0],""),g=f[0].split(" ")[1].match(/\d+/g)[0]):h=h.replace(d.from+" ","")}var m="1"!==a&&a!==d.from||this.severities[u]<this.severities[this.state.severity];!m&&o&&(m="object"===typeof h?!h.original.toLowerCase().includes(o):!h.toLowerCase().includes(o));var b=i===d.key?n:d.key;i=d.key,t.push(Object(ue.jsxs)(v.a,{className:Object(c.default)(s.row,d.odd&&s.rowOdd,m&&s.hidden,this.lastRowRender&&d.ts>this.lastRowRender&&s.updatedRow),style:this.state.colors?{backgroundColor:(null===(l=this.state.sources[d.from])||void 0===l?void 0:l.color)||void 0}:{},hover:!0,children:[Object(ue.jsx)(j.a,{className:Object(c.default)(s.cell,s.cellName),children:Object(ue.jsxs)("div",{className:s.iconAndName,children:[Object(ue.jsx)(ie.a,{src:d.icon,className:s.icon}),Object(ue.jsx)("div",{className:s.name,children:d.from})]})}),this.state.pid&&Object(ue.jsx)(j.a,{className:Object(c.default)(s.cell,s[this.props.themeType+"_"+u]),children:g}),Object(ue.jsx)(j.a,{className:Object(c.default)(s.cell,s[this.props.themeType+"_"+u]),children:d.time}),Object(ue.jsx)(j.a,{className:Object(c.default)(s.cell,s[this.props.themeType+"_"+u]),children:d.severity}),Object(ue.jsx)(j.a,{className:Object(c.default)(s.cell,s[this.props.themeType+"_"+u]),title:"object"===typeof h?h.original:h,children:"object"===typeof h?h.parts.map((function(e,t){return Object(ue.jsx)("span",{style:e.style,children:e.text},t)})):h})]},b))}}return(!this.lastRowRender||Date.now()-this.lastRowRender>1e3)&&(this.lastRowRenderTimeout||(this.lastRowRenderTimeout=setTimeout((function(){e.lastRowRenderTimeout=null,e.lastRowRender=Date.now()}),1e3))),t}},{key:"renderClearDialog",value:function(){var e=this,t=this.props.classes;return Object(ue.jsxs)(S.a,{onClose:function(){return e.closeLogDelete()},open:this.state.logDeleteDialog,children:[Object(ue.jsxs)(C.a,{children:[this.t("Please confirm"),Object(ue.jsx)(g.a,{className:t.closeButton,onClick:function(){return e.closeLogDelete()},children:Object(ue.jsx)(H.a,{})})]}),Object(ue.jsx)(L.a,{dividers:!0,children:Object(ue.jsx)(w.a,{gutterBottom:!0,children:this.t("Log file will be deleted. Are you sure?")})}),Object(ue.jsxs)(k.a,{children:[Object(ue.jsx)(h.a,{variant:"contained",autoFocus:!0,onClick:function(){return e.handleLogDelete()},color:"primary",startIcon:Object(ue.jsx)(Q.a,{}),children:this.t("Ok")}),Object(ue.jsx)(h.a,{variant:"contained",onClick:function(){return e.closeLogDelete()},startIcon:Object(ue.jsx)(H.a,{}),children:this.t("Cancel")})]})]})}},{key:"changePid",value:function(){var e=!this.state.pid;window.localStorage.setItem("Logs.pid",JSON.stringify(e)),this.setState({pid:e})}},{key:"render",value:function(){var e,t=this;if(!this.state.logs)return Object(ue.jsx)(D.a,{});var s=this.props.classes;null!==this.state.logFiles||this.readLogsInProcess||(this.readLogsInProcess=!0,setTimeout((function(){return t.readLogFiles().then((function(e){t.readLogsInProcess=!1,t.setState({logFiles:e})}))}),100));var o=Object.keys(this.state.sources).sort();o.unshift("1");var a=this.state.pause?Object(ue.jsx)(w.a,{className:s.pauseCount,children:this.state.logs.length-this.state.pause}):Object(ue.jsx)(B.a,{});return Object(ue.jsxs)(le.a,{children:[Object(ue.jsxs)(de.a,{children:[Object(ue.jsx)(I.a,{title:this.props.t("Refresh log"),children:Object(ue.jsx)(g.a,{onClick:function(){return t.readLogs(!0)},children:Object(ue.jsx)(A.a,{})})}),Object(ue.jsx)(I.a,{title:this.props.t("Pause output"),children:Object(ue.jsx)(g.a,{className:s.pauseButton,onClick:function(){return t.handleLogPause()},children:a})}),Object(ue.jsx)(I.a,{title:this.props.t("Clear log"),children:Object(ue.jsx)(g.a,{onClick:function(){return t.clearLog()},children:Object(ue.jsx)(F.a,{})})}),Object(ue.jsx)(I.a,{title:this.props.t("Clear on disk permanent"),children:Object(ue.jsx)(g.a,{onClick:function(){return t.openLogDelete()},children:Object(ue.jsx)(_.a,{})})}),Object(ue.jsx)(I.a,{title:this.props.t("Show/hide PID"),children:Object(ue.jsx)(g.a,{onClick:function(){return t.changePid()},color:this.state.pid?"primary":"default",children:Object(ue.jsx)("div",{className:s.pidSize,children:this.props.t("PID")})})}),Object(ue.jsx)(I.a,{title:this.props.t("Show/hide colors"),children:Object(ue.jsx)(g.a,{onClick:function(){window.localStorage.setItem("Logs.colors",t.state.colors?"false":"true"),t.setState({colors:!t.state.colors})},color:this.state.colors?"primary":"default",children:Object(ue.jsx)(X.FaPalette,{})})}),Object(ue.jsx)(I.a,{title:this.props.t("Show errors"),children:Object(ue.jsx)(N.a,{badgeContent:this.state.logErrors,color:"error",classes:{badge:Object(c.default)(s.badge,s.badgeError)},children:Object(ue.jsx)(g.a,{onClick:function(){"error"===t.state.severity?t.setState({severity:"debug"}):t.setState({severity:"error",logErrors:0})},color:"error"===this.state.severity?"primary":"default",children:Object(ue.jsx)(G.a,{})})})}),Object(ue.jsx)(I.a,{title:this.props.t("Show errors and warnings"),children:Object(ue.jsx)(N.a,{badgeContent:this.state.logWarnings,color:"default",classes:{badge:Object(c.default)(s.badge,s.badgeWarn)},children:Object(ue.jsx)(g.a,{onClick:function(){"warn"===t.state.severity?t.setState({severity:"debug"}):t.setState({severity:"warn",logWarnings:0})},color:"warn"===this.state.severity?"primary":"default",children:Object(ue.jsx)(q.a,{})})})}),Object(ue.jsx)("div",{className:s.grow}),(null===(e=this.state.logFiles)||void 0===e?void 0:e.length)>0&&Object(ue.jsxs)("div",{children:[Object(ue.jsx)(h.a,{variant:"contained",color:"primary",startIcon:Object(ue.jsx)(Y.a,{}),onClick:function(e){return t.openLogDownload(e)},children:this.t("Download log")}),Object(ue.jsx)(x.a,{id:"simple-menu",anchorEl:this.state.logDownloadDialog,keepMounted:!0,open:Boolean(this.state.logDownloadDialog),onClose:function(){return t.closeLogDownload()},children:this.getLogFiles()})]}),Object(ue.jsx)("div",{className:s.grow}),Object(ue.jsxs)(w.a,{variant:"body2",title:this.state.estimatedSize?this.props.t("Estimated size"):"",className:s.logSize,children:[this.t("Log size:")," ",Object(ue.jsx)("span",{className:this.state.estimatedSize?s.logEstimated:"",children:null===this.state.logSize?"-":ne.a.formatBytes(this.state.logSize)})]})]}),Object(ue.jsx)(ce.a,{children:Object(ue.jsx)(m.a,{className:s.container,children:Object(ue.jsxs)(p.a,{stickyHeader:!0,size:"small",className:s.table,children:[Object(ue.jsx)(b.a,{children:Object(ue.jsxs)(v.a,{children:[Object(ue.jsx)(j.a,{className:s.source,children:Object(ue.jsxs)(E.a,{className:s.formControl,children:[Object(ue.jsx)(z.a,{id:"source-label"}),Object(ue.jsx)(W.a,{labelId:"source-label",value:o.includes(this.state.source)?this.state.source:"1",onChange:function(e){return t.handleSourceChange(e)},children:this.getSources()})]})}),this.state.pid&&Object(ue.jsx)(j.a,{className:s.pid,children:Object(ue.jsx)(O.a,{disabled:!0,label:this.t("PID"),className:s.header})}),Object(ue.jsx)(j.a,{className:s.timestamp,children:Object(ue.jsx)(O.a,{disabled:!0,label:this.t("Time"),className:s.header})}),Object(ue.jsx)(j.a,{className:s.severity,children:Object(ue.jsxs)(E.a,{className:s.formControl,children:[Object(ue.jsx)(z.a,{id:"severity-label"}),Object(ue.jsx)(W.a,{labelId:"severity-label",value:this.state.severity,onChange:function(e){return t.handleSeverityChange(e)},children:this.getSeverities()})]})}),Object(ue.jsx)(j.a,{className:s.message,children:Object(ue.jsx)(E.a,{className:s.formControl,children:Object(ue.jsx)(O.a,{className:s.messageText,label:this.t("Message"),onChange:function(e){return t.handleMessageChange(e)},value:this.state.message,InputProps:{endAdornment:this.state.message?Object(ue.jsx)(g.a,{size:"small",onClick:function(e){t.setState({message:""})},children:Object(ue.jsx)(H.a,{})}):null}})})})]})}),Object(ue.jsx)(f.a,{children:this.getRows()})]})})}),this.renderClearDialog()]})}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.currentHost!==t.currentHost?{currentHost:e.currentHost,logs:[],logFiles:null}:null}}]),s}(l.Component);t.default=Object(d.a)()(Object(u.a)((function(e){return{container:{height:"100%"},table:{tableLayout:"fixed",minWidth:960,"& td,th":{padding:"3px 4px"},"& td:nth-of-type(5)":{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}},row:{},rowOdd:{backgroundColor:e.palette.background.default},cell:{verticalAlign:"top"},cellName:{lineHeight:"14px"},updatedRow:{animation:"updated 1s"},formControl:{width:"100%"},light_error:{color:ae.a[800]},light_warn:{color:ee.a[800]},light_debug:{color:se.a[800]},light_silly:{color:se.a[700]},dark_error:{color:ae.a[200]},dark_warn:{color:ee.a[200]},dark_debug:{color:se.a[300]},dark_silly:{color:se.a[200]},source:{width:200},pid:{width:55},timestamp:{width:175},severity:{width:80},message:{minWidth:300},hidden:{display:"none"},grow:{flexGrow:1},logSize:{marginRight:"1rem",marginLeft:"1rem"},logEstimated:{fontStyle:"italic"},closeButton:{position:"absolute",right:e.spacing(1),top:e.spacing(1),color:e.palette.grey[500]},header:{"& .MuiFormLabel-root.Mui-disabled":{color:e.palette.text.primary},"& .MuiInput-underline::before":{content:"",borderBottom:"none"}},pauseButton:{minWidth:e.spacing(6)},pauseCount:{color:ee.a[500]},downloadLogSize:{color:se.a[500],marginLeft:e.spacing(2)},downloadEntry:{display:"flex",justifyContent:"space-between"},pidSize:{fontSize:14,width:24,height:24,display:"flex",alignItems:"center"},"@media screen and (max-width: 450px)":{row:{"& > *":{fontSize:8}},source:{width:120},pid:{width:40},timestamp:{width:100},severity:{width:61},message:{minWidth:150},formControl:{"& > *":{fontSize:"10px !important"}},header:{"& > *":{fontSize:"10px !important"}},messageText:{"& > *":{fontSize:"10px !important"}}},badge:{top:10,right:10},badgeError:{},badgeWarn:{backgroundColor:ee.a[500]},emptyButton:{width:48},icon:{width:16,height:16},iconSelect:{width:24,height:25,marginRight:4},name:{verticalAlign:"top",display:"inline-block",marginTop:1,marginLeft:2,overflow:"hidden",whiteSpace:"nowrap",width:"100%",textOverflow:"ellipsis"},iconAndName:{whiteSpace:"nowrap",display:"flex"}}}))(je))}}]);
//# sourceMappingURL=12.490971aa.chunk.js.map